<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>studio</title>
	<!-- Webix Library -->
	<script type="text/javascript" src="/html/assets/webix/webix.js"></script>
	<script type="text/javascript" src="/html/assets/locales/kr_doc.js"></script>
	<script type="text/javascript" src="/html/assets/addition/screenfull.js"></script>
	<script type="text/javascript" src="/html/assets/addition/crypto-js.min.js"></script>
	<script type="text/javascript" src="/html/assets/addition/functions.js"></script>
	<script type="text/javascript" src="/html/assets/addition/defintionOfURL.js"></script>
	<script type="text/javascript" src="/html/assets/addition/sharedComponent.js"></script>
	<!-- Css -->
	<link rel="stylesheet" type="text/css" href="/html/assets/webix/skins/flat.css" />
	<link rel="stylesheet" type="text/css" href="/html/assets/css/MaterialDesign/css/materialdesignicons.min.css" />
	<style>
		.webix_view.webix_el_label.borderR {
			border-right: solid 1px grey !important;
			height: 45px !important;
		}

		.webix_fmanager_card_panel {
			position: relative;
			padding: 10px 12px;
			height: 36px;
			background-color: rgba(0, 0, 0, 0.5);
		}

		.webix_fmanager_card_name {
			display: inline-block;
			white-space: nowrap;
			font-weight: 500;
			width: 155px;
			height: 29px;
			line-height: 30px;
			color: #f8f8f8;
		}

		body.webix_full_screen {
			overflow: scroll;
		}

		.grey .webix_el_box {
			color: #bfbfbf;
		}
	</style>
	<style>
		/*disable text selection if needed (otherwise, ignore this part)*/
		.webix_tree_item {
			user-select: none;
			/* standard syntax */
			-webkit-user-select: none;
			/* webkit (safari, chrome) browsers */
			-moz-user-select: none;
			/* mozilla browsers */
			-khtml-user-select: none;
			/* webkit (konqueror) browsers */
			-ms-user-select: none;
			/* IE10+ */
		}

		.webix_tree_item.webix_selected span {
			background: #1F884C !important;
		}
	</style>
	<style>
		.webix_fmanager_card_label {
			position: absolute;
			padding: 4px;
			bottom: 3px;
			left: 3px;
			height: 15px;
			line-height: 15px;
			font-weight: bold;
			color: #475466;
			background-color: rgba(255, 200, 200, 0.8);
			border-radius: 15px;
		}

		.button {
			padding: 10px;
			display: inline;
			border-radius: 2px;
			font-family: "Arial";
			border: 0;
			margin: 0 10px;
			background: red;
			font-size: 15px;
			line-height: 15px;
			color: white;
			width: auto;
			height: auto;
			box-sizing: content-box;
		}
	</style>
	<style>
		.custom_blockarea {
			position: fixed;
			border: 2px solid #5210ec;
			background-color: rgba(230, 120, 17, 0.2);
		}
	</style>
	<style>
		.overall {
			height: 100%;
			line-height: 26px;
		}

		.name {
			height: 100%;
			width: 280px;
			float: left;
			overflow: hidden;
		}

		.size {
			padding: 0 10px;
			width: 100px;
			text-align: right;
			float: right;
		}

		.remove_file {
			float: right;
			width: 15px;
			padding-left: 10px;
		}

		.status {
			float: right;
			position: relative;
			margin-top: 4px;
			width: 180px;
			height: 16px;
			line-height: 16px;
			border: 1px solid #A4BED4;
			border-radius: 2px;
			-moz-border-radius: 2px;
			-webkit-border-radius: 2px;
		}

		.progress {
			height: 100%;
			position: absolute;
			background-color: #0899e7;
			margin: 0px, 0px, 0px, 0px;
			border: 0px, 0px, 0px, 0px;
		}

		.message {
			z-index: 1;
			width: 100%;
			text-align: center;
			position: absolute;
		}

		.message.error {
			color: #e83b3b;
		}
	</style>
	<style>
		.messages-list .webix_list_item {
			display: flex;
			max-width: 80%;
		}

		.messages-list .webix_list_item.webix_comments_current {
			margin-left: 20%;
		}

		.messages-list .webix_list_item:last-child {
			margin-bottom: 24px;
		}

		.messages-list .message {
			flex-grow: 1;
			/* background: #f4f5f9; */
			background: #5c5b5b;
			border-radius: 0px 8px 8px 8px;
			padding: 10px 20px 20px;
		}

		.messages-list .webix_comments_message {
			margin: 0;
		}

		.messages-list .webix_chat_list_avatar {
			flex-shrink: 0;
			margin-right: 15px;
			margin-left: 15px;
		}

		.messages-list .webix_comments_name {
			margin-left: 0;
		}
	</style>
	<style>
		.webix_fmanager_prompt .webix_win_head .webix_toolbar {
			/* background: #ffffff; */
			background: #3a3939;
		}
	</style>
	<style>
		html,
		body {
			background-color: #ffffff;

		}

		.content {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.image .webix_template {
			position: relative;
			background: #aaa;
			/* padding: 50px 60px; */
			padding: 0px;
		}

		.title {
			position: absolute;
			left: 10px;
			bottom: 15px;
			color: #000;
			font-size: 16px;
		}
	</style>
	<style>
		.webix_dataview .webix_scroll_cont {
			padding: 0px !important;
		}
	</style>
	<style>
		/* for templates */
		.draft .webix_template {
			display: table;
			width: 100%;
		}

		.draft .webix_template .title1 {
			display: table-cell;
			text-align: center;
			vertical-align: middle;
			font-size: 24px;
		}
	</style>
	<style>
		/* dashboard and panels */
		.panel_drag_view {
			border-radius: 2px;
			box-shadow: 0px 0px 10px #b9d4fa;
		}

		.panel_icon {
			color: #283655;
		}

		.panel_target {
			background: #d0e1f9ab;
			box-shadow: 0px 0px 20px 5px #d0e1f9ab;
		}

		.draft .webix_template {
			display: table;
			width: 100%;
		}

		.draft .webix_template .title {
			display: table-cell;
			text-align: center;
			vertical-align: middle;
			font-size: 24px;
		}

		.webix_view.webix_flexlayout {
			height: auto !important;
		}
	</style>
	<style>
		.webix_el_slider .webix_el_box,
		.webix_el_slider {
			height: 50px !important;
		}

		.female-feed .webix_slider_title {
			color: white;
			background-color: orange;
			width: 22px;
			height: 22px;
			border-radius: 50% 50%;
			border-color: transparent;
			text-align: center;
			align-items: center;
			font-size: 12px;
		}

		.male-feed .webix_slider_title {
			color: white;
			background-color: blue;
			width: 22px;
			height: 22px;
			border-radius: 50% 50%;
			border-color: transparent;
			text-align: center;
			align-items: center;
			font-size: 12px;
		}

		.female-feed .webix_slider_box .webix_slider_left {
			background: orange !important;
		}

		.male-feed .webix_slider_box .webix_slider_left {
			background: blue !important;
		}
	</style>
</head>

<body class="webix_full_screen" oncontextmenu="return false"></body>
<script>
	const user = JSON.parse(sessionStorage.getItem("user"));
    const farm = 1;
    const menu_data = [
        {
            id: "dashboard", icon: "mdi mdi-view-dashboard", value: "main", data: [
                { id: "dashboard1", value: "Dashboard " },
            ]
        },
        {
            id: "layouts", icon: "mdi mdi-view-column", value: "analysis", data: [
                { id: "accordions", value: "an1" },
                { id: "portlets", value: "an2" }
            ]
        },
        {
            id: "tables", icon: "mdi mdi-table", value: "managingFeed", data: [
                { id: "tables1", value: "manage1" },
                { id: "tables2", value: "manage2" },
                { id: "tables3", value: "manage3" }
            ]
        },
        {
            id: "uis", icon: "mdi mdi-puzzle", value: "managingFarm", data: [
                { id: "dataview", value: "DataView" },
                { id: "list", value: "farm1" },
                { id: "menu", value: "farm2" },
                { id: "tree", value: "farm3" },
                { id: "register-farm", value: "register"},
                { id: "register-breed", value: "register breed"},
                { id: "register-worker", value: "register worker"}
            ]
        },
    ];
	const sidebar = {
		view: "sidebar",
		data: menu_data,
		ready: function () {
			this.select("tables1");
			this.open(this.getParentId("tables1"));
		},
		on: {
			onAfterSelect: function (id) {
				$$("multi").setValue(id)
                sessionStorage.setItem("lastPage", id);
			}
		}
	};
    const farm_select_win = webix.ui({
			view:"window",
			id:"farm_select_win",
			modal: true,
			move: true,
			position: "center",
			responsive: "a1",
			elementsConfig: { labelPosition: "left", },
			head: {
				view: "toolbar",
				elements: [
					{
						view: "label",
						label: "Select a Farm",
						align: "center",
					},
					{ 
						view: "icon",
						icon: "wxi-close",
						hotkey: "esc",
						width: 40,
						click: function () {
							$$("farm_select_win").hide();
						},
					},
				],
			},
			body:{
				view: "form",
				id: "farm_select_form",
				elementsConfig: {
					bottomPadding: 18,
					labelWidth: 100,
				},
				css: {
					margin: "auto!important",
				},
				elements: [
					{ 
						view:"select", label:"Farm Name: ", id: "farms", labelAlign:"right" 
					},
					{
						view: "button", value: "Select", css: "webix_primary",
						click: function() {
							var farm = $$("farms").getValue();
							sessionStorage.setItem("user_group_idx", farm);
							this.getTopParentView().hide();

							const user = JSON.parse(sessionStorage.getItem('ifrm_user'));
							webix.ajax().get(schedulerUrl + "farms/breeds", { uID: user.id, fID: farm }).then(function(data){
								if (parseInt(data.text()) > 0) {
									sessionStorage.setItem("breedID", data.text())
								} else {
									window.location.href = "register-breed"
								}
							})
						}
					}
				],
			},
		});
    // ----------- Manage feed first page Start ----------------
    const feed_label = {
        view: "label",
        label: "Feeding each building",
        css: {
            "font-size": "20px",
            "font-weight": "bold"
        }
    }
    const datepicker = {
        view: "datepicker",
		id: "date",
        value: new Date(2012, 6, 8),
        format: "%Y, %m-%d %l",
        timepicker: true,
        width: 300
    };
    const save_button = {
        view: "button",
        label: "Save",
        id: "save_button"
    }
    const panel = {
        view: "panel",
        body: {
            padding: 20,
            rows: [
                {
                    cols: [
                        {
                            view: "template",
                            name: "$value",
                            template: "<span style='border-radius: 50%; padding: 5px; background: lightgrey;'>#month#</span>",
                            css: {
                                "border": "none!important;"
                            }
                        },
                        {
                            view: "switch", value: 1,
                            gravity: 0.25,
                            on: {
                                onChange: function (newValue, oldValue, config) {
									const male_feed = this.getParentView().getParentView().getChildViews()[7];
									const female_feed = this.getParentView().getParentView().getChildViews()[5];
									if (newValue == 0) {
										male_feed.disable();
										female_feed.disable();
									} else {
										male_feed.enable();
										female_feed.enable();
									}	
								}
                            }
                        }
                    ]
                },
                { height: 20 },
                {
                    cols: [
                        {
                            view: "label",
                            template: "<input style='color: blue; width: 50px; margin: auto; text-align: center' value='100'/><div>male feed</div>",
                            align: "center",
                            css: "borderR"
                        },
                        {
                            view: "label",
                            template: "<input style='color: blue; width: 50px; margin: auto; text-align: center' value='100'/><div>female feed</div>",
                            align: "center",
                            css: "borderR"
                        },
                        {
                            view: "label",
                            template: "<div style='color: blue'>200</div><div>total feed</div>",
                            align: "center",
                        },
                    ],
                    css: {
                        "padding": "10px",
                        "background": "lightgrey",
                        "width": "auto!important",
                        "margin-right": "20px"
                    }
                },
                { height: 80 },
                {
                    view: "label",
                    label: "female-feed-graph",
                },
                { view: "slider", value: "50", min: 0, max: 100, title: "#value#", css: "female-feed" },
                {
                    view: "label",
                    label: "male-feed-graph",
                },
                { view: "slider", value: "50", min: 0, max: 100, title: "#value#", css: "male-feed" }
            ],
            height: 400
        },
        minWidth: 330,
        minHeight: 400
    }
    const panels = {
        margin: 10, padding: 0,
        view: "flexdatalayout",
        cols: [panel],
        url: "https://docs.webix.com/samples/60_pro/13_layout/data/year.js"
    }
	const manage_feed1 = {
			view: "form",
			id: "tables1",
			elements: [
				{
					cols: [
						feed_label,
						{},
						{ view:"icon", icon:"wxi-angle-left", id:"prev", click: function(){ 
							changeRange(-1);
						}},
						datepicker,
						{ view:"icon", icon:"wxi-angle-right", id:"next", click: function(){
							changeRange(1);
						}},
						{},
						save_button
					]
				},
				{
					view: "label",
					label: "Info feeding"
				},
				{
					view: "scrollview",
					body: webix.copy(panels)
				}
			]
		};
	// ----------- Manage feed first page End ----------------

    // ----------- Register Farm page Start ----------------
    const neccessary_label = {
        view: "label",
        label: "Farm information",
        id: "label_a",
        css: {
            color: "grey",
            "border-bottom": "1px solid!important"
        }
    };
    const save_farm_button = {
        view: "button",
        label: "Save",
        id: "save_farm_button",
        gravity: 0.2,
        click: function () {
            var form = $$('register-farm')
            if (form.validate()) {
                $$("avatar").send(function() {
                    const val = form.getValues();
                    webix.ajax().post(schedulerUrl + 'farms/register', {
                        farm_code: val.farm_code1,
                        vete_code: val.farm_code2,
                        business_code: val.business_code,
                        farm_name: val.farm_name,
                        farm_addr1: val.farm_address,
                        farm_addr2: val.farm_address2,
                        owner_idx: user.id,
                        owned: val.ownership,
                        farm_kind: val.kind_farm,
                        employee_domes: val.employee_domestic,
                        employee_forign: val.employee_foreigner,
                        partner_company: val.partner,
                        farm_breed: "",
                        window_type: val.windows,
                        wast_type: val.carridor,
                        building_num: val.building_num,
                        building_type: val.kind_building,
                        outer_type: val.outer,
                        permission_date: val.permission_date,
                        capacity_breed: val.capacity_breed,
                        is_ict: val.is_ict,
                        avatar: val.avatar
                    }).then(function (data) {
                        if (data.text() != "") {
                            webix.alert({ title: "Register Farm", type: "alert-success", text: "Register a farm successfully!" }).then(function() {
                                webix.confirm("Do you want to add more farms?", "confirm-warning")
                                .then(function(result){
                                    window.location.href = "register-farm";
                                })
                                .fail(function(){
                                    sessionStorage.setItem("user_group_idx", data.text());

                                    webix.ajax().get(schedulerUrl + "farms/breeds", { uID: user.id, fID: data.text() }).then(function(data){
                                        if (parseInt(data.text()) > 0) {
                                            sessionStorage.setItem("breedID", data.text())
                                        } else {
                                            window.location.href = "register-breed"
                                        }
                                    })
                                });
                            })
                        }
                        else {
                            webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning" })
                        }
                    });
                });
            }
        }
    }
    const farm_code1_input = {
        view: "text",
        type: "text",
        name: "farm_code1",
        label: "Farm code1",
        id: "farm_code1",
        placeholder: "Enter Farm code1",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your farm code1!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("farm_code2").focus();
                }

            }
        },
    };
    const farm_code2_input = {
        view: "text",
        type: "text",
        name: "farm_code2",
        label: "Farm code2",
        id: "farm_code2",
        placeholder: "Enter Farm code2",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your farm code2!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("farm_name").focus();
                }

            }
        },
    };
    const farm_name_input = {
        view: "text",
        type: "text",
        name: "farm_name",
        label: "Farm name",
        id: "farm_name",
        placeholder: "Enter Farm name",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your farm name!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("kind_farm").focus();
                }

            }
        },
    };
    const kind_farm = {
        view: "richselect",
        label: "Kind of Farm",
        name: "kind_farm",
        id: "kind_farm",
        required: true,
        value: 1, options: [
            { "id": 1, "value": "farm 1" },
            { "id": 2, "value": "farm 2" },
            { "id": 3, "value": "farm 3" }
        ],
    }
    const farm_address_label = {
        view: "label",
        label: "Farm Address *",
        width: 120
    }
    const farm_address = {
        cols: [
            {
                view: "text",
                type: "text",
                name: "farm_address",
                id: "farm_address",
                placeholder: "Enter Farm address",
                required: true,
                validate: webix.rules.isNotEmpty,
                invalidMessage: "Please enter farm address!",
                validateEvent: "key",
                on: {
                    "onBlur": function () {
                        this.validate()
                    },
                    "onKeyPress": function (key, e) {
                        if (key == 13) {
                            $$("farm_address2").focus();
                        }
                    }
                },
            },
            {
                rows: [
                    {
                        view: "button",
                        name: "search",
                        label: "search",
                        id: "search",
                        on: {
                            "onClick": function () {
                                this.validate()
                            },
                        },
                        css: "webix_primary",
                        width: 100,
                    }, {}
                ]

            }
        ],
    };
    const farm_address2_input = {
        view: "text",
        type: "text",
        name: "farm_address2",
        label: "Farm Address2",
        id: "farm_address2",
        placeholder: "Enter Farm address",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your farm address!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("building_num").focus();
                }

            }
        },
    };
    const ownership = {
        view: "radio",
        name: "ownership",
        id: "ownership",
        label: "Onwership",
        value: 1, options: [
            { "id": 1, "value": "own" },
            { "id": 2, "value": "lease" }
        ]
    }
    const building_num_input = {
        view: "text",
        type: "text",
        name: "building_num",
        label: "Building Number",
        id: "building_num",
        placeholder: "Enter Building Number",
        required: true,
        validate: webix.rules.isNumber,
        invalidMessage: "Please enter your building number!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("partner").focus();
                }

            }
        },
    };
    const employees = {
        cols: [
            { view: "label", label: "Employees" },
            {
                view: "select",
                name: "employee_domestic",
                value: 1, options: [
                    { "id": 1, "value": "domestic" },
                    { "id": 2, "value": "5" },
                    { "id": 3, "value": "10" },
                    { "id": 4, "value": "20" },
                ],
                inputAlign: "right"
            },
            {
                view: "select",
                name: "employee_foreigner",
                value: 1, options: [
                    { "id": 1, "value": "foreigner" },
                    { "id": 2, "value": "5" },
                    { "id": 3, "value": "10" },
                    { "id": 4, "value": "20" },
                ],
                inputAlign: "right"
            },
        ]
    }
    const partner_input = {
        view: "text",
        type: "text",
        name: "partner",
        label: "Partner",
        id: "partner",
        placeholder: "Enter partner",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your partner!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("business_code").focus();
                }

            }
        },
    };
    const windows = {
        view: "radio",
        name: "windows",
        id: "windows",
        label: "Windows",
        value: 1, options: [
            { "id": 1, "value": "no" },
            { "id": 2, "value": "yes" },
            { "id": 3, "value": "both" },
        ],
    }
    const carridor = {
        view: "radio",
        name: "carridor",
        id: "carridor",
        label: "Carridor (Roof)",
        value: 1, options: [
            { "id": 1, "value": "yes" },
            { "id": 2, "value": "no" },
            { "id": 3, "value": "both" },
        ],
    }
    const photo = {
        view:"photo",
        name:"photo",
        css:"form_photo",
        id:"form_photo",
        value: "/html/assets/img/avatar.png",
        height:150,
        width:150
    };
    const user_avatar = {
        cols:[
            { view: "label", label: "Photo", width: 120 },
            photo,
            { width: 120 },
            {
                rows: [
                    {
                        view: "label",
                        label: user ? user.user_name: ""
                    },
                    {},
                    {
                        cols: [
                            {
                                view:"uploader", id: "avatar", name: "avatar", value:"Upload", accept:"image/*", autosend:false, autowidth:true, multiple:false, width:200, 
                                upload: schedulerUrl + "farms/avatar",
                                on:{        
                                    onAfterFileAdd: function(upload){        
                                        var file = upload.file;
                                        var reader = new FileReader(); 

                                        reader.onload = function(event) {
                                            $$("form_photo").setValue(event.target.result);
                                        };           
                                        reader.readAsDataURL(file)
                                        return false;
                                    },
                                    onUploadComplete: function(response) {
                                    }
                                },
                            }, 
                            { view: "button", label: "delete" , click: function() {
                                webix.confirm("Do you really want to delete it?", "confirm-warning")
                                .then(function(result){
                                    $$("form_photo").setValue("/html/assets/img/avatar.png");
                                })
                                .fail(function(){
                                });
                            }},
                        ]
                    },
                    {}
                ],
            },
        ]
    };
    function showForm(winId, node) {
        $$(winId).getBody().clear();
        $$(winId).show(node);
        $$(winId).getBody().focus();
    }
    const password = {
        cols: [
            {
                view: "label",
                label: "Password *",
                gravity: 0.4
            },
            {
                view: "button",
                label: "Change Password",
                click: function (id, event) {
                    showForm("change_password")
                }
            },
            {}
        ]

    };
    const business_code_input = {
        view: "text",
        type: "text",
        name: "business_code",
        label: "Business code",
        id: "business_code",
        placeholder: "Enter Business Code",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your Business Code!",
        on: {
            "onBlur": function () {
                var result = this.validate()    
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("kind_hen").focus();
                }

            }
        },
    };
    const kind_hen = {
        view: "richselect",
        label: "Kind of hen",
        name: "kind_hen",
        id: "kind_hen",
        required: true,
        value: 1, options: [
            { "id": 1, "value": "kind 1" },
            { "id": 2, "value": "kind 2" },
            { "id": 3, "value": "kind 3" }
        ],
    }
    const kind_building = {
        view: "radio",
        name: "kind_building",
        id: "kind_building",
        label: "Kind of building",
        value: 1, options: [
            { "id": 1, "value": "normal" },
            { "id": 2, "value": "pannel" },
            { "id": 3, "value": "textile" },
        ],
    }
    const outer = {
        view: "radio",
        name: "outer",
        id: "ourter",
        label: "Outer (Roof)",
        value: 1, options: [
            { "id": 1, "value": "yes" },
            { "id": 2, "value": "no" },
            { "id": 3, "value": "both" },
        ],
    }
    const permission_date = {
        view:"datepicker", 
        name: "permission_date",
        value: new Date(2012, 6, 8), 
        label: "Permission Date", 
        timepicker: false,
    };
    const capacity_breed = {
        view: "text",
        type: "text",
        name: "capacity_breed",
        label: "Capacity Breed",
        id: "capacity_breed",
        placeholder: "Enter Capacity Breed",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your Capacity Breed!",
        on: {
            "onBlur": function () {
                var result = this.validate()    
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("is_ict").focus();
                }

            }
        },
    };
    const is_ict = {
        view: "switch", 
        name: "is_ict",
        value: 1, 
        label:"ICT",
    };
    const change_password_form = {
        view: "form",
        borderless: true,
        elements: [
            { view: "text", type: "password", label: 'Using Password', name: "current_password", id: "current_password", invalidMessage: "please input current password!" },
            { view: "text", type: "password", label: 'New Password', name: "new_password", id: "new_password", invalidMessage: "please input new password!"},
            { view: "text", type: "password", label: 'Confirm Password', name: "confirm_password", id: "confirm_password", invalidMessage: "please input new password correct!"},
            {
                cols: [
                    {
                        view: "button", value: "Save", id: "submit_btn", click: function () {
                            if (this.getParentView().getParentView().validate()) { 
                                const form_value = this.getParentView().getParentView().getValues();

                                webix.ajax().post(schedulerUrl + 'users/' + user.user_id + '/changePassword', {
                                    current_password: form_value.current_password,
                                    new_password: form_value.new_password
                                }).then(function(res) {
                                    switch (res.text()) {
                                        case "error":
                                            webix.alert("Your current password is incorrect! please try again!","alert-error");
                                            break;
                                        case "success":
                                            webix.alert("Your current password is changed!","alert-success").then(function(result){
                                                $$("submit_btn").getTopParentView().hide();
                                            });
                                            
                                            break;
                                    }
                                })
                            }
                        }
                    },
                    {
                        view: "button", value: "Cancel", click: function () {
                            this.getTopParentView().hide(); 
                        }
                    }
                ]
            }
        ],
        rules: {
            current_password: webix.rules.isNotEmpty,
            new_password: webix.rules.isNotEmpty,
            confirm_password:function(value){
                if ( value == "" || value != $$("new_password").getValue()){
                    return false;
                }
                return true;
            }
        },
        elementsConfig: {
            labelPosition: "top",
        }
    };
    webix.ui({
        view: "window",
        id: "change_password",
        position: "center",
        modal: true,
        close: true,
        head: "Change Password",
        body: webix.copy(change_password_form)
    });
    const register_farm_page = {
        view: "form",
        id: "register-farm",
        elementsConfig: {
            bottomPadding: 18,
            labelWidth: 130,
            padding: 10
        },
        elements: [

            {
                cols: [
                    neccessary_label,
                    save_farm_button
                ]
            },
            {
                cols: [
                    {
                        rows: [
                            farm_code1_input,
                            farm_code2_input,
                            farm_name_input,
                            kind_farm,
                            {
                                cols: [
                                    farm_address_label,
                                    farm_address
                                ]
                            },
                            farm_address2_input,
                            ownership,
                            building_num_input,
                            employees,
                            partner_input,
                            windows,
                            carridor
                        ],
                    },
                    {
                        rows: [
                            user_avatar,
                            password,
                            business_code_input,
                            kind_hen,
                            kind_building,
                            outer,
                            permission_date,
                            capacity_breed,
                            is_ict
                        ],
                    },
                ]
            },
            {}
        ]
    };
    // ----------- Register Farm page End ----------------
    // ----------- Register Breed page Start ----------------
    const breed_details = webix.ui({
        view:"window",
        id:"breed_details",
        modal: true,
        move: true,
        position: "center",
        responsive: "a1",
        scroll: true,
        borderless	: 	true,
        autowidth: true,
        width: 1500,
        height: 800,
        elementsConfig: { labelPosition: "left", },
        head: {
            view: "toolbar",
            elements: [
                {
                    view: "label",
                    label: "Breed Details",
                    align: "center",
                },
                { 
                    view: "icon",
                    icon: "wxi-close",
                    hotkey: "esc",
                    width: 40,
                    click: function () {
                        $$("breed_details").hide();
                    },
                },
            ],
        },
        body:{
            view: "form",
            id: "breed_form",
            scroll: true,
            elementsConfig: {
                bottomPadding: 18,
                labelWidth: 100,
            },
            css: {
                margin: "auto!important",
            },
            elements: [
                {view: "label", label: "farm information"},
                {
                    cols: [
                        {
                            rows: [
                                {view: "text", label: "Farm Name", id: "breed_farm_name", name: "breed_farm_name", readonly:true},
                                {view: "text", label: "Province", id: "breed_province", name: "breed_province", readonly:true},
                                {view: "text", label: "Mobile", id: "mobile", name: "mobile", readonly:true},
                                {view: "text", label: "User ID", id: "user_id", name: "user_id", readonly:true},
                                {view: "text", label: "Office", id: "office", name: "office", readonly:true},
                            ]
                        },
                        {
                            rows: [
                                {view: "text", label: "Owner Name", id: "owner_name", name: "owner_name", readonly:true},
                                {view: "text", label: "Onwer Addr", id: "owner_addr", name: "owner_addr", readonly:true},
                                {view: "text", label: "Number Of Building", id: "building_num1", name: "building_num", readonly:true},
                                {view: "text", label: "Password", id: "password", name: "password", readonly:true},
                            ]
                        }
                    ]
                },
                {view: "label", label: "breed information"},
                {
                    cols: [
                        {
                            rows: [
                                {view: "text", label: "Parter", id: "breed_parter", name: "breed_parter", readonly:true},
                                {view: "text", label: "Female Head", id: "breed_female_head", name: "breed_female_head", readonly:true},
                            ]
                        },
                        {
                            rows: [
                                {view: "text", label: "Start date", id: "breed_start_date", name: "breed_start_date", readonly:true},
                                {view: "text", label: "Male Head", id: "breed_male_head", name: "breed_male_head", readonly:true},
                            ]
                        },
                        {
                            rows: [
                                {view: "text", label: "Bio Type", id: "breed_biotype", name: "breed_biotype", readonly:true},
                                {view: "text", label: "Start Weekage", id: "breed_start_weekage", name: "breed_start_weekage", readonly:true},
                            ]
                        },
                    ]
                },
                {
                    cols: [
                        {
                            rows: [
                                {view: "text", label: "Female building1", id: "fe_building1", name: "fe_building1"},
                                {view: "text", label: "Female building2", id: "fe_building2", name: "fe_building2"},
                                {view: "text", label: "Female building3", id: "fe_building3", name: "fe_building3"},
                                {view: "text", label: "Female building4", id: "fe_building4", name: "fe_building4"},
                                {view: "text", label: "Female building5", id: "fe_building5", name: "fe_building5"},
                                {view: "text", label: "Female building6", id: "fe_building6", name: "fe_building6"},
                                {view: "text", label: "Female building7", id: "fe_building7", name: "fe_building7"},
                                {view: "text", label: "Female building8", id: "fe_building8", name: "fe_building8"},
                                {view: "text", label: "Female building9", id: "fe_building9", name: "fe_building9"},
                                {view: "text", label: "Female building10", id: "fe_building10", name: "fe_building10"},
                            ]
                        },
                        {
                            rows: [
                                {view: "text", label: "Male building1", id: "ma_building1", name: "ma_building1"},
                                {view: "text", label: "Male building2", id: "ma_building2", name: "ma_building2"},
                                {view: "text", label: "Male building3", id: "ma_building3", name: "ma_building3"},
                                {view: "text", label: "Male building4", id: "ma_building4", name: "ma_building4"},
                                {view: "text", label: "Male building5", id: "ma_building5", name: "ma_building5"},
                                {view: "text", label: "Male building6", id: "ma_building6", name: "ma_building6"},
                                {view: "text", label: "Male building7", id: "ma_building7", name: "ma_building7"},
                                {view: "text", label: "Male building8", id: "ma_building8", name: "ma_building8"},
                                {view: "text", label: "Male building9", id: "ma_building9", name: "ma_building9"},
                                {view: "text", label: "Male building10", id: "ma_building10", name: "ma_building10"},
                            ]
                        },
                    ],
                },
                {view: "label", label: "cut of farm"},
                {
                    cols: [
                        {view: "datepicker", name: "end_date", id: "end_date", placeholder: "End Date"},
                        {view: "text", name: "out_type", id: "out_type", placeholder: "Out Type"},
                        {view: "text", name: "out_company", id: "out_company", placeholder: "Out Company"},
                    ]
                },
                {
                    cols: [
                        {}, {view: "button", value: "Save"},
                        {view: "button", value: "Cancel"}
                    ]
                },
            ],
            elementsConfig: {
                labelWidth: 120,
                margin: 10
            }
        },
    });

    const register_breed_page = {
        view: "form",
        id: "register-breed",
        elementsConfig: {
            bottomPadding: 18,
            labelWidth: 130,
            padding: 10
        },
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    {
                        view: "label",
                        template: "Farm Information",
                        css: {
                            "font-size": "24px"
                        }
                    },
                    {
                        cols : [
                            {
                                view: "label",
                                label: "Register"
                            },
                            {},
                            { 
                                type: "section",
                                borderless: true,
                                cols:[
                                    {}, { view:"icon", icon:"mdi mdi-printer"},{ view:"icon", icon:"mdi mdi-folder-upload"},{ view:"icon", icon:"mdi mdi-folder-download"}
                                ]
                            },
                        ]
                        
                    },
                    {
                        type: "section",
                        cols: [
                            { view: "label", label: "farm name", gravity: 0.1 },
                            { view: "label", label: "province", gravity: 0.1 },
                            { view: "label", label: "city", gravity: 0.1 },
                            { view: "label", label: "parter", gravity: 0.1 },
                            { view: "label", label: "start_date", gravity: 0.1 },
                            { view: "label", label: "biotype", gravity: 0.1 },
                            { view: "label", label: "female_head", gravity: 0.1 },
                            { view: "label", label: "male_head", gravity: 0.1 },
                            { view: "label", label: "start_weekage", gravity: 0.1 },
                            { gravity: 0.1}
                        ],
                        css: {
                            "background": "lightgrey!important"
                        }
                    },
                    {
                        view: "form",
                        id: "register_form",
                        margin: 10,
                        borderless: true,
                        cols: [
                            { view: "text", placeholder: "farm name", id: "farm_name1", name: "farm_name", gravity: 0.1 },
                            { view: "text", placeholder: "province", id: "province", name: "province", gravity: 0.1 },
                            { view: "text", placeholder: "city", id: "city", name: "city", gravity: 0.1 },
                            { view: "text", placeholder: "parter", id: "parter", name: "parter", gravity: 0.1 },
                            { view: "datepicker", placeholder: "start_date", id: "start_date", name: "start_date", gravity: 0.1 },
                            { view: "richselect", placeholder: "biotype", id: "biotype", name: "biotype", gravity: 0.1, options: ["AA", "BB", "AB"]},
                            { view: "text", placeholder: "female_head", id: "female_head", name: "female_head", gravity: 0.1, attributes:{type:"number"} },
                            { view: "text", placeholder: "male_head", id: "male_head", name: "male_head", gravity: 0.1, attributes:{type:"number"} },
                            { view: "text", placeholder: "start_weekage", id: "start_weekage", name: "start_weekage", gravity: 0.1, attributes:{type:"number"} },
                            { 
                                rows: [
                                    {
                                        view: "button", value: "register", css: "webix-primary",
                                        click: function(){
                                            if ($$("register_form").validate()) {
                                                const val = $$("register_form").getValues();
                                                webix.ajax().post(schedulerUrl + "breeds/register", {
                                                    user_idx: user.id,
                                                    farm_idx: sessionStorage.getItem("user_group_idx"),
                                                    building_no: "0",
                                                    farm_name: val.farm_name,
                                                    province: val.province,
                                                    city: val.city,
                                                    parter: val.parter,
                                                    start_date: val.start_date,
                                                    biotype: val.biotype,
                                                    female_head: val.female_head,
                                                    male_head: val.male_head,
                                                    start_weekage: val.start_weekage,
                                                    end_weekage: "0"
                                                }).then(function(data) {
                                                    if (data.text() != "") {
                                                        webix.alert({ title: "Register Breed", type: "alert-success", text: "Register a breed successfully!" }).then(function() {
                                                            sessionStorage.setItem("breed_idx", data.text())
                                                            window.location.href="register-breed";
                                                        })
                                                    }
                                                    else {
                                                        webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning" })
                                                    }
                                                })
                                            }
                                        }
                                    },
                                    {}
                                ],
                                gravity: 0.1,
                                css: {
                                    "margin": "auto!important"
                                }
                            },
                        ],
                        rules: {
                            $all:webix.rules.isNotEmpty,
                        }
                    },
                    {
                        view: "label",
                        label: "List of breed"
                    },
                    {
                        view:"datatable",
                        id: "grid",
                        autoConfig:true,
                        url:function(params){
                            var data = webix.ajax().sync().get(schedulerUrl + "breeds/all", {
                                uID: user.id,
                                fID: farm
                            }).responseText;
                            this.parse(data);
                        },
                        onClick:{
                            "wxi-trash":function(event, id, node){
                                webix.ajax().del(schedulerUrl + "breeds/remove?id=" + id.row).then(function(result) {
                                    if (result.text() != "") {
                                        window.location.href = "register-breed"
                                    }
                                })
                            },
                            "wxi-pencil":function(event, id, node){
                                webix.ajax().get(schedulerUrl + "breeds/select", {id: id.row}).then(function(result) {
                                    console.log(result.text());
                                    const breed = JSON.parse(result.text());
                                    breed_details.show();

                                })
                            }
                        }
                    },
                ]
            }
        ],
    };
    // ----------- Register Breed page End ----------------
    webix.ready(function () {
		if (!user) {
			window.location.href = "login";
		}
		webix.ui({
			rows: [
				{
					view: "toolbar", padding: 3, elements: [
						{
							view: "icon", icon: "mdi mdi-menu", click: function () {
								$$("$sidebar1").toggle();
							}
						},
						{ view: "label", label: "DonilFarm" },
						{},
						{ view: "button", label: "CCTV", gravity: 0.3 },
						{ view: "button", label: "scheduler", gravity: 0.3 },
						{
							view: "icon",
							icon: "mdi mdi-calendar-clock",
							tooltip: "스케줄보기",
							click: function () {
								location.href = "/scheduler";
							}
						},
						{ view: "button", label: "myInfo", gravity: 0.3 },
						{ view: "icon", icon: "mdi mdi-comment", badge: 4 },
						{ view: "icon", icon: "mdi mdi-bell", badge: 10 }
					]
				},
				{
					cols: [
						sidebar,
						{
							id: "multi",
							animate: false,
							cells: [
								{
									id: "dashboard1",
									template: "dashboard"
								},
								manage_feed1,
                                register_farm_page,
                                register_breed_page
							]
						}

					]
				},

			]
		});
    
        var columns = $$("grid").config.columns;
        if (columns.length > 3) {
            columns.splice(columns.length, 0,{
                id:"trash",
                header:"Delete",
                template: "{common.trashIcon()}"
            });
            $$("grid").refreshColumns();

            columns.splice(columns.length-1, 0,{
                id:"edit",
                header:"Edit",
                template: "{common.editIcon()}"
            });
            $$("grid").refreshColumns();
        }
    });

	function changeRange(sign){
		const date = $$("date").getValue();

		let new_date = webix.Date.add(date, sign, "day");
		$$("date").setValue(new_date);
	}
</script>
</body>

</html>