<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>studio</title>
	<!-- Webix Library -->
	<script type="text/javascript" src="/html/assets/webix/webix.js"></script>
	<script type="text/javascript" src="/html/assets/locales/kr_doc.js"></script>
	<script type="text/javascript" src="/html/assets/addition/screenfull.js"></script>
	<script type="text/javascript" src="/html/assets/addition/crypto-js.min.js"></script>
	<script type="text/javascript" src="/html/assets/addition/functions.js"></script>
	<script type="text/javascript" src="/html/assets/addition/defintionOfURL.js"></script>
	<script type="text/javascript" src="/html/assets/addition/sharedComponent.js"></script>
	<!-- Css -->
	<link rel="stylesheet" type="text/css" href="/html/assets/webix/skins/flat.css" />
	<link rel="stylesheet" type="text/css" href="/html/assets/css/MaterialDesign/css/materialdesignicons.min.css" />
	<style>
		.webix_view.webix_el_label.borderR {
			border-right: solid 1px grey !important;
			height: 45px !important;
		}

		.webix_fmanager_card_panel {
			position: relative;
			padding: 10px 12px;
			height: 36px;
			background-color: rgba(0, 0, 0, 0.5);
		}

		.webix_fmanager_card_name {
			display: inline-block;
			white-space: nowrap;
			font-weight: 500;
			width: 155px;
			height: 29px;
			line-height: 30px;
			color: #f8f8f8;
		}

		body.webix_full_screen {
			overflow: scroll;
		}

		.grey .webix_el_box {
			color: #bfbfbf;
		}

        .webix_el_checkbox {
            margin: 0!important;
        }
	</style>
	<style>
		/*disable text selection if needed (otherwise, ignore this part)*/
		.webix_tree_item {
			user-select: none;
			/* standard syntax */
			-webkit-user-select: none;
			/* webkit (safari, chrome) browsers */
			-moz-user-select: none;
			/* mozilla browsers */
			-khtml-user-select: none;
			/* webkit (konqueror) browsers */
			-ms-user-select: none;
			/* IE10+ */
		}

		.webix_tree_item.webix_selected span {
			background: #1F884C !important;
		}
	</style>
	<style>
		.webix_fmanager_card_label {
			position: absolute;
			padding: 4px;
			bottom: 3px;
			left: 3px;
			height: 15px;
			line-height: 15px;
			font-weight: bold;
			color: #475466;
			background-color: rgba(255, 200, 200, 0.8);
			border-radius: 15px;
		}

		.button {
			padding: 10px;
			display: inline;
			border-radius: 2px;
			font-family: "Arial";
			border: 0;
			margin: 0 10px;
			background: red;
			font-size: 15px;
			line-height: 15px;
			color: white;
			width: auto;
			height: auto;
			box-sizing: content-box;
		}
	</style>
	<style>
		.custom_blockarea {
			position: fixed;
			border: 2px solid #5210ec;
			background-color: rgba(230, 120, 17, 0.2);
		}
	</style>
	<style>
		.overall {
			height: 100%;
			line-height: 26px;
		}

		.name {
			height: 100%;
			width: 280px;
			float: left;
			overflow: hidden;
		}

		.size {
			padding: 0 10px;
			width: 100px;
			text-align: right;
			float: right;
		}

		.remove_file {
			float: right;
			width: 15px;
			padding-left: 10px;
		}

		.status {
			float: right;
			position: relative;
			margin-top: 4px;
			width: 180px;
			height: 16px;
			line-height: 16px;
			border: 1px solid #A4BED4;
			border-radius: 2px;
			-moz-border-radius: 2px;
			-webkit-border-radius: 2px;
		}

		.progress {
			height: 100%;
			position: absolute;
			background-color: #0899e7;
			margin: 0px, 0px, 0px, 0px;
			border: 0px, 0px, 0px, 0px;
		}

		.message {
			z-index: 1;
			width: 100%;
			text-align: center;
			position: absolute;
		}

		.message.error {
			color: #e83b3b;
		}
	</style>
	<style>
		.messages-list .webix_list_item {
			display: flex;
			max-width: 80%;
		}

		.messages-list .webix_list_item.webix_comments_current {
			margin-left: 20%;
		}

		.messages-list .webix_list_item:last-child {
			margin-bottom: 24px;
		}

		.messages-list .message {
			flex-grow: 1;
			/* background: #f4f5f9; */
			background: #5c5b5b;
			border-radius: 0px 8px 8px 8px;
			padding: 10px 20px 20px;
		}

		.messages-list .webix_comments_message {
			margin: 0;
		}

		.messages-list .webix_chat_list_avatar {
			flex-shrink: 0;
			margin-right: 15px;
			margin-left: 15px;
		}

		.messages-list .webix_comments_name {
			margin-left: 0;
		}
	</style>
	<style>
		.webix_fmanager_prompt .webix_win_head .webix_toolbar {
			/* background: #ffffff; */
			background: #3a3939;
		}
	</style>
	<style>
		html,
		body {
			background-color: #ffffff;

		}

		.content {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.image .webix_template {
			position: relative;
			background: #aaa;
			/* padding: 50px 60px; */
			padding: 0px;
		}

		.title {
			position: absolute;
			left: 10px;
			bottom: 15px;
			color: #000;
			font-size: 16px;
		}
	</style>
	<style>
		.webix_dataview .webix_scroll_cont {
			padding: 0px !important;
		}
	</style>
	<style>
		/* for templates */
		.draft .webix_template {
			display: table;
			width: 100%;
		}

		.draft .webix_template .title1 {
			display: table-cell;
			text-align: center;
			vertical-align: middle;
			font-size: 24px;
		}
	</style>
	<style>
		/* dashboard and panels */
		.panel_drag_view {
			border-radius: 2px;
			box-shadow: 0px 0px 10px #b9d4fa;
		}

		.panel_icon {
			color: #283655;
		}

		.panel_target {
			background: #d0e1f9ab;
			box-shadow: 0px 0px 20px 5px #d0e1f9ab;
		}

		.draft .webix_template {
			display: table;
			width: 100%;
		}

		.draft .webix_template .title {
			display: table-cell;
			text-align: center;
			vertical-align: middle;
			font-size: 24px;
		}

		.webix_view.webix_flexlayout {
			height: auto !important;
		}
	</style>
	<style>
		.webix_el_slider .webix_el_box,
		.webix_el_slider {
			height: 50px !important;
		}

		.female-feed .webix_slider_title {
			color: white;
			background-color: orange;
			width: 22px;
			height: 22px;
			border-radius: 50% 50%;
			border-color: transparent;
			text-align: center;
			align-items: center;
			font-size: 12px;
		}

		.male-feed .webix_slider_title {
			color: white;
			background-color: blue;
			width: 22px;
			height: 22px;
			border-radius: 50% 50%;
			border-color: transparent;
			text-align: center;
			align-items: center;
			font-size: 12px;
		}

		.female-feed .webix_slider_box .webix_slider_left {
			background: orange !important;
		}

		.male-feed .webix_slider_box .webix_slider_left {
			background: blue !important;
		}
	</style>
    <style>
        .webix_list-x .webix_scroll_cont {
            display: flex;
            flex-wrap: wrap;
        }
        div.webix_list_item {
            padding: 2px;
            cursor: unset;
        }
        div.webix_list_item .hoverButton {
            display: initial;
            float: right;
        }
        div.webix_list_item .close-icon {
            cursor: pointer;
            border-radius: 50%;
            font-size: 14px;
            background-color: white;
            margin-left: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        div.webix_list_item .medi {
            color: white;
            background-color: orange;
            padding: 0px 5px;
            border-radius: 20px;
            font-size: smaller;
        }

        div.webix_list_item .non-medi {
            color: white;
            background-color: blue;
            padding: 0px 5px;
            border-radius: 20px;
            font-size: smaller;
        }

        .webix_icon.wxi-pencil, .webix_icon.wxi-trash {
            cursor: pointer!important;
        }
    </style>
    <style>
        .slider {
            width: 100%;
        }
        .food_inventory {
            display: flex;
        }
        .medi_inventory {
            display: flex;
        }
        .non_medi_inventory {
            display: flex;
        }
        .food_nutri_inventory {
            display: flex;
        }
    </style>
</head>

<body class="webix_full_screen" oncontextmenu="return false">
    <div id="template_container" hidden>
        <div class='overall'>
          <div class='name'>#code#.</div>
          <div class='date'>#date#</div>
          <div class='invetory'>#in_qnty# * #unit_price#</div>
          <div class='amount'>#in_qnty# * #unit_price#</div>
          <div class='edit_icon'>edit</div>
          <div class='delete_icon'>delete</div>
        </div>
    </div>
</body>
<script>
	const user = JSON.parse(sessionStorage.getItem("user"));
    if (!user) {
        window.location.href = "login";
    }
    var panelID="";
    var building_num = 0;
    const menu_data = [
        {
            id: "dashboard", icon: "mdi mdi-view-dashboard", value: "main", data: [
                { id: "dashboard1", value: "Dashboard " },
            ]
        },
        {
            id: "uis", icon: "mdi mdi-puzzle", value: "Management Farm", data: [
                { id: "register-partner", value: "register partner company"},
                { id: "register-farm", value: "register farm"},
                { id: "register-biotype", value: "register biotype"},
                { id: "register-breed", value: "register breed"},
                { id: "register-authority", value: "register authority rule"},
                { id: "register-worker", value: "register worker"},
                { id: "register-fmn", value: "register fmn code"},
                { id: "register-nutri", value: "register nutri"},
                { id: "register-food", value: "register food"},
                { id: "register-saleitem", value: "register sale item"},
                { id: "manage-sale", value: "Manage Sale"},
                { id: "register-expenseitem", value: "register expense item"},
                { id: "manage-expense", value: "Manage Expense"},
            ]
        },
        {
            id: "manage-breed", icon: "mdi mdi-table", value: "Management Breed", data: [
                { id: "send-breed", value: "Send Breed"},
                { id: "manage-feed", value: "manage feed"},
                { id: "supply-water", value: "Supply water"},
            ]
        },
    ];
	const sidebar = {
		view: "sidebar",
        id: "menu_list",
		data: menu_data,
        scroll: "auto",
		ready: function () {
			this.select("dashboard1");
			this.open(this.getParentId("dashboard1"));
		},
		on: {
			onAfterSelect: function (id) {
                $$("multi").setValue(id)
                switch (id) {
                    case "dashboard1":
                        webix.ajax().get(schedulerUrl + "farms/all", {
                            owner_idx: user.id
                        }).then(function(data) {
                            const farms = data.json();
                            
                            if (farms && farms.length > 0) {
                                const user_group_idx = sessionStorage.getItem("user_group_idx");
                                const breed_code = sessionStorage.getItem("breed_code");
                                if (farms.length > 1) {
                                    var farms_value = [];
                                    farms.forEach(farm => {
                                        farms_value.push({
                                            id: farm.id,
                                            title: farm.farm_name
                                        })
                                    });
                                    $$("farms").define("data", farms_value);
                                    if (!user_group_idx) {
                                        farm_select_win.show();
                                    } else {
                                        select_breed();
                                    }
                                } else {
                                    sessionStorage.setItem("user_group_idx", farms[0].id);
                                    select_breed();
                                }
                            } else {
                                webix.alert({
                                    title:"Warning!",
                                    text:"You don't have any farms. please register farm first!",
                                    type:"alert-warning"
                                })
                                .then(function(result){
                                    $$("menu_list").select("register-farm");
                                    $$("menu_list").open($$("menu_list").getParentId("register-farm"));
                                })
                            }
                        })
                        
                        break;
                    case "register-farm":
                        const farm = sessionStorage.getItem("user_group_idx");
                        if (farm) {
                            webix.ajax().get(schedulerUrl + "farms/select", {
                                id: farm
                            }).then(function(data) {
                                const farm_info = data.json();
                                $$("farm_code1").setValue(farm_info.farm_code);
                                $$("farm_code2").setValue(farm_info.vete_code);
                                $$("business_code").setValue(farm_info.business_code);
                                $$("farm_name").setValue(farm_info.farm_name);
                                $$("farm_address").setValue(farm_info.farm_addr1);
                                $$("farm_address2").setValue(farm_info.farm_addr2);
                                $$("ownership").setValue(farm_info.owned);
                                $$("kind_farm").setValue(farm_info.farm_kind);
                                $$("employee_domestic").setValue(farm_info.employee_domes);
                                $$("employee_foreigner").setValue(farm_info.employee_forign);
                                $$("partner").setValue(farm_info.partner_company);
                                $$("windows").setValue(farm_info.window_type);
                                $$("carridor").setValue(farm_info.wast_type);
                                $$("building_num").setValue(farm_info.building_num);
                                $$("kind_building").setValue(farm_info.building_type);
                                $$("outer").setValue(farm_info.outer_type);
                                $$("permission_date").setValue(new Date(farm_info.permission_date));
                                $$("capacity_breed").setValue(farm_info.capacity_breed);
                                $$("is_ict").setValue(farm_info.is_ict);
                                $$("avatar").setValue(farm_info.avatar);
                                $$("form_photo").setValue(schedulerUrl + "avatars/farm/" + farm_info.avatar);
                                $$("farm_id").setValue(farm_info.id);
                            });
                        }

                    case "register-breed":
                        refresh_breed_grid();
                        refresh_biotype_grid();
                        break;
                    case "register-partner":
                        refre
                        break;
                    case "register-worker":
                        refresh_worker_grid();
                        break;
                    case "manage-sale":
                        refresh_sale_grid();
                        refresh_sale_item_grid();
                        break;
                    default:
                        break;
                }

			}
		}
	};
    const farm_select_win = webix.ui({
        view:"window",
        id:"farm_select_win",
        modal: true,
        move: true,
        position: "center",
        responsive: "a1",
        elementsConfig: { labelPosition: "left", },
        head: {
            view: "toolbar",
            elements: [
                {
                    view: "label",
                    label: "Select a group",
                    align: "center",
                },
                { 
                    view: "icon",
                    icon: "wxi-close",
                    hotkey: "esc",
                    width: 40,
                    click: function () {
                        $$("farm_select_win").hide();
                    },
                },
            ],
        },
        body:{
            view: "form",
            id: "farm_select_form",
            elementsConfig: {
                bottomPadding: 18,
                labelWidth: 100,
            },
            css: {
                margin: "auto!important",
            },
            elements: [
                { 
                    view:"list", template:"#title#", id: "farms", width: 250, height: 200, select: true
                },
                {
                    view: "button", value: "Select",
                    click: function() {
                        var farm = $$("farms").getSelectedId();
                        sessionStorage.setItem("user_group_idx", farm);
                        this.getTopParentView().hide();

                        select_breed();
                    }
                }
            ],
        },
    });
    const breed_select_win = webix.ui({
        view:"window",
        id:"breed_select_win",
        modal: true,
        move: true,
        position: "center",
        responsive: "a1",
        elementsConfig: { labelPosition: "left", },
        head: {
            view: "toolbar",
            elements: [
                {
                    view: "label",
                    label: "Select a breed",
                    align: "center",
                },
                { 
                    view: "icon",
                    icon: "wxi-close",
                    hotkey: "esc",
                    width: 40,
                    click: function () {
                        $$("breed_select_win").hide();
                    },
                },
            ],
        },
        body:{
            view: "form",
            id: "breed_select_form",
            elementsConfig: {
                bottomPadding: 18,
                labelWidth: 100,
            },
            css: {
                margin: "auto!important",
            },
            elements: [
                { 
                    view:"list", template:"#title#", id: "breeds", width: 250, height: 200, select: true
                },
                {
                    view: "button", value: "Select",
                    click: function() {
                        var breed = $$("breeds").getSelectedId();

                        sessionStorage.setItem("breed_code", breed);
                        
                        this.getTopParentView().hide();
                    }
                }
            ],
        },
    });
    // ----------- Register partner company Page Start ----------------
    const register_partner_label = {
        view: "label",
        template: "Register Partner Company",
        css: {
            "font-size": "24px"
        }
    };
    const register_partner_header = {
        cols : [
            {
                view: "label",
                label: "Register partner"
            },
            {},
            { 
                align:"right",
                body:{ 
                    view: "search", placeholder: "search", id: "partner_search", name: "search", icon: "wxi-search" , gravity: 0.1 , width: 200,
                    on:{
                        onChange: function(newValue, oldValue, config){
                            refresh_partner_grid(newValue);
                        }
                    }
                }
            },
        ]
    };
    const register_partner_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "date", gravity: 0.1 },
            { view: "label", label: "category", gravity: 0.1 },
            { view: "label", label: "name", gravity: 0.1 },
            { view: "label", label: "business code", gravity: 0.1 },
            { view: "label", label: "description", gravity: 0.1 },
            { gravity: 0.1}
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    };
    const register_partner_form = {
        view: "form",
        id: "register_partner_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "partner_id", name: "id" },
            { view: "datepicker", placeholder: "date", id: "date8", name: "date" , gravity: 0.1 },
            { view: "richselect", placeholder: "Company Category", id: "partner_category", name: "partner_category", gravity: 0.1, options: [
                { id: 1, value: "Meat Dealer" }, 
                { id: 2, value: "Egg Dealer" },
                { id: 3, value: "Administration" },
                { id: 4, value: "Poultry Farm" },
                { id: 5, value: "Veterinary" },
                { id: 6, value: "Hatchery" },
                { id: 7, value: "Suppler" },
            ]},
            { view: "text", placeholder: "company name", id: "partner_name", name: "partner_name" , gravity: 0.1 },
            { view: "text", placeholder: "business code", id: "partner_businesscode", name: "partner_businesscode" , pattern: { mask: "###-##-#####", allow: /[0-9]/g }, gravity: 0.1 },
            { view: "text", placeholder: "company description", id: "partner_description", name: "partner_description", gravity: 0.1 },
            {
                view: "button", value: "Register", gravity: 0.1, id: "register_partnercode_button",
                click: function() {
                    if ($$("register_partner_form").validate()) {
                        const val = $$("register_partner_form").getValues();
                        const user_idx = user.id;
                        const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                        
                        webix.ajax().post(schedulerUrl + "partners/register", {
                            user_idx: user_idx,
                            date: val.date,
                            id: val.id,
                            partner_category: val.partner_category,
                            partner_name: val.partner_name,
                            partner_businesscode: val.partner_businesscode,
                            partner_description: val.partner_description
                        }).then(function(data) {
                            const response = JSON.parse(data.text());
                            if (response != "") {
                                if (val.id == "" ) {
                                    webix.alert({ title: "Register partner", type: "alert-success", text: "Register a partner successfully!" }).then(function (result){
                                        refresh_partner_grid("");
                                        $$("register_partner_form").clear();
                                        
                                        webix.ajax().get(schedulerUrl + "partners/options?user_idx=" + user.id, function(text, data){
                                            var options = data.json();
                                        
                                            var list = $$("partner").getPopup().getList();
                                            list.clearAll();
                                            list.parse(options);

                                        });
                                    })
                                } else {
                                    webix.alert({ title: "Update partner", type: "alert-success", text: "Update a partner successfully!" })
                                    $$("register_partner_form").clear();
                                    $$("register_partnercode_button").setValue("Register");

                                    refresh_partner_grid("");
                                    webix.ajax().get(schedulerUrl + "partners/options?user_idx=" + user.id, function(text, data){
                                        var options = data.json();
                                    
                                        var list = $$("partner").getPopup().getList();
                                        list.clearAll();
                                        list.parse(options);

                                    });
                                }
                            } else {
                                webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                            }
                        })
                    }
                }
            }
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        }
    };
    const register_partner_list_label = {
        view: "label",
        label: "List of partner"
    };
    const register_partner_datatable = {
        view:"datatable",
        id: "partner_grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"date", header:"Date", fillspace:true },
            { id:"partner_category", header:"Company type", fillspace:true, template: function(obj) {
                var result = "";
                switch (obj.partner_category) {
                    case "1":
                        result = "Meat Dealer"
                        break;
                    case "2":
                        result = "Egg Dealer"
                        break;
                    case "3":
                        result = "Administration"
                        break;
                    case "4":
                        result = "Poultry Farm"
                        break;
                    case "5":
                        result = "Veterinary"
                        break;
                    case "6":
                        result = "Hatchery"
                        break;
                    case "7":
                        result = "Suppler"
                        break;

                    default:
                        result = "Meat Dealer"
                        break;
                }

                return result;
            }},
            { id:"partner_name", header:"Company Name", fillspace:true },
            { id:"partner_businesscode", header:"Business code", fillspace:true },
            { id:"partner_description",	header:"Company description", fillspace:true },
        ],
        url:function(params){
            const user_id = user.id;
            const user_group_idx = sessionStorage.getItem("user_group_idx");
            var data = webix.ajax().sync().get(schedulerUrl + "partners/all", {
                user_idx: user_id,
            }).responseText;
            this.parse(data);
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "partners/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_partner_grid("");
                        webix.ajax().get(schedulerUrl + "partners/options?user_idx=" + user.id, function(text, data){
                            var options = data.json();
                        
                            var list = $$("partner").getPopup().getList();
                            list.clearAll();
                            list.parse(options);
                        });
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "partners/select", {id: id.row}).then(function(result) {
                    const partner = result.json();
                    $$("date8").setValue(new Date(partner.date));
                    $$("partner_id").setValue(partner.id);
                    $$("partner_category").setValue(partner.partner_category);
                    $$("partner_name").setValue(partner.partner_name);
                    $$("partner_businesscode").setValue(partner.partner_businesscode);
                    $$("partner_description").setValue(partner.partner_description);
                    $$("register_partnercode_button").setValue("Update");
                })
            }
        }
    };
    const register_partner_page = {
        view: "form",
        id: "register-partner",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_partner_label,
                    register_partner_header,
                    register_partner_label_list,
                    register_partner_form,
                    register_partner_list_label,
                    register_partner_datatable,
                ]
            }
        ],
    };
    // ----------- Register partner company Page End ----------------
    // ----------- Register Farm page Start ----------------
    const neccessary_label = {
        view: "label",
        label: "Farm information",
        id: "label_a",
        css: {
            color: "grey",
            "border-bottom": "1px solid!important"
        }
    };
    const save_farm_button = {
        view: "button",
        label: "Save",
        id: "save_farm_button",
        gravity: 0.2,
        click: function () {
            var form = $$('register-farm')
            if (form.validate()) {
                $$("avatar").send(function() {
                    const val = form.getValues();
                    webix.ajax().post(schedulerUrl + 'farms/register', {
                        id: val.id,
                        farm_code: val.farm_code1,
                        vete_code: val.farm_code2,
                        business_code: val.business_code,
                        farm_name: val.farm_name,
                        farm_addr1: val.farm_address,
                        farm_addr2: val.farm_address2,
                        owner_idx: user.id,
                        owned: val.ownership,
                        farm_kind: val.kind_farm,
                        employee_domes: val.employee_domestic,
                        employee_forign: val.employee_foreigner,
                        partner_company: val.partner,
                        farm_breed: "",
                        window_type: val.windows,
                        wast_type: val.carridor,
                        building_num: val.building_num,
                        building_type: val.kind_building,
                        outer_type: val.outer,
                        permission_date: val.permission_date,
                        capacity_breed: val.capacity_breed,
                        is_ict: val.is_ict,
                        avatar: val.avatar
                    }).then(function (data) {
                        if (data.text() != "") {
                            if (val.id == "") {
                                webix.alert({ title: "Register Farm", type: "alert-success", text: "Register a farm successfully!" }).then(function() {
                                    webix.confirm("Do you want to add more farms?", "confirm-warning")
                                    .then(function(result){
                                        $$("register-farm").clear();
                                        $$("farm_id").setValue("");
                                    })
                                    .fail(function(){
                                        $$("menu_list").select("dashboard1");
                                        $$("menu_list").open($$("menu_list").getParentId("dashboard1"));
                                    });
                                })
                            } else {
                                webix.alert({ title: "Update Farm", type: "alert-success", text: "Update a farm successfully!" });
                            }
                        }
                        else {
                            webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning" })
                        }
                    });
                });
            }
        }
    }
    const farm_code1_input = {
        view: "text",
        type: "text",
        name: "farm_code1",
        label: "Farm code1",
        id: "farm_code1",
        placeholder: "Enter Farm code1",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your farm code1!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("farm_code2").focus();
                }

            }
        },
    };
    const farm_code2_input = {
        view: "text",
        type: "text",
        name: "farm_code2",
        label: "Farm code2",
        id: "farm_code2",
        placeholder: "Enter Farm code2",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your farm code2!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("farm_name").focus();
                }

            }
        },
    };
    const farm_name_input = {
        view: "text",
        type: "text",
        name: "farm_name",
        label: "Farm name",
        id: "farm_name",
        placeholder: "Enter Farm name",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your farm name!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("kind_farm").focus();
                }

            }
        },
    };
    const kind_farm = {
        view: "richselect",
        label: "Kind of Farm",
        name: "kind_farm",
        id: "kind_farm",
        required: true,
        value: 1, options: [
            { "id": 1, "value": "farm 1" },
            { "id": 2, "value": "farm 2" },
            { "id": 3, "value": "farm 3" }
        ],
    }
    const farm_address_label = {
        view: "label",
        label: "Farm Address *",
        width: 120
    }
    const farm_address = {
        cols: [
            {
                view: "text",
                type: "text",
                name: "farm_address",
                id: "farm_address",
                placeholder: "Enter Farm address",
                required: true,
                validate: webix.rules.isNotEmpty,
                invalidMessage: "Please enter farm address!",
                validateEvent: "key",
                on: {
                    "onBlur": function () {
                        this.validate()
                    },
                    "onKeyPress": function (key, e) {
                        if (key == 13) {
                            $$("farm_address2").focus();
                        }
                    }
                },
            },
            {
                rows: [
                    {
                        view: "button",
                        name: "search",
                        label: "search",
                        id: "search",
                        on: {
                            "onClick": function () {
                                this.validate()
                            },
                        },
                        css: "webix_primary",
                        width: 100,
                    }, {}
                ]

            }
        ],
    };
    const farm_address2_input = {
        view: "text",
        type: "text",
        name: "farm_address2",
        label: "Farm Address2",
        id: "farm_address2",
        placeholder: "Enter Farm address",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your farm address!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("building_num").focus();
                }

            }
        },
    };
    const ownership = {
        view: "radio",
        name: "ownership",
        id: "ownership",
        label: "Onwership",
        value: 1, options: [
            { "id": 1, "value": "own" },
            { "id": 2, "value": "lease" }
        ]
    }
    const building_num_input = {
        view: "text",
        type: "text",
        name: "building_num",
        label: "Building Number",
        id: "building_num",
        attributes:{type:"number"},
        placeholder: "Enter Building Number",
        required: true,
        validate: webix.rules.isNumber,
        invalidMessage: "Please enter your building number!",
        on: {
            "onBlur": function () {
                var result = this.validate()
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("partner").focus();
                }

            }
        },
    };
    const employees = {
        cols: [
            { view: "label", label: "Employees" },
            {
                view: "richselect",
                name: "employee_domestic",
                id: "employee_domestic",
                value: 1, options: [
                    { "id": 1, "value": "domestic" },
                    { "id": 2, "value": "5" },
                    { "id": 3, "value": "10" },
                    { "id": 4, "value": "20" },
                ],
            },
            {
                view: "richselect",
                name: "employee_foreigner",
                id: "employee_foreigner",
                value: 1, options: [
                    { "id": 1, "value": "foreigner" },
                    { "id": 2, "value": "5" },
                    { "id": 3, "value": "10" },
                    { "id": 4, "value": "20" },
                ],
            },
        ]
    }
    const partner_input = {
        view: "richselect",
        label: "Partner",
        name: "partner",
        id: "partner",
        placeholder: "Partner",
        required: true,
        options: schedulerUrl + "partners/options?user_idx=" + user.id,
    };
    const windows = {
        view: "radio",
        name: "windows",
        id: "windows",
        label: "Windows",
        value: 1, options: [
            { "id": 1, "value": "no" },
            { "id": 2, "value": "yes" },
            { "id": 3, "value": "both" },
        ],
    }
    const carridor = {
        view: "radio",
        name: "carridor",
        id: "carridor",
        label: "Carridor (Roof)",
        value: 1, options: [
            { "id": 1, "value": "yes" },
            { "id": 2, "value": "no" },
            { "id": 3, "value": "both" },
        ],
    }
    const photo = {
        view:"photo",
        name:"photo",
        css:"form_photo",
        id:"form_photo",
        value: "/html/assets/img/avatar.png",
        height:150,
        width:150
    };
    const user_avatar = {
        cols:[
            { view: "label", label: "Photo", width: 120 },
            photo,
            { width: 120 },
            {
                rows: [
                    {
                        view: "label",
                        label: user ? user.user_name: ""
                    },
                    {},
                    {
                        cols: [
                            {
                                view:"uploader", id: "avatar", name: "avatar", value:"Upload", accept:"image/*", autosend:false, autowidth:true, multiple:false, width:200, 
                                upload: schedulerUrl + "farms/avatar",
                                on:{        
                                    onAfterFileAdd: function(upload){        
                                        var file = upload.file;
                                        var reader = new FileReader(); 

                                        reader.onload = function(event) {
                                            $$("form_photo").setValue(event.target.result);
                                        };           
                                        reader.readAsDataURL(file)
                                        return false;
                                    },
                                    onUploadComplete: function(response) {
                                    }
                                },
                            }, 
                            { view: "button", label: "delete" , click: function() {
                                webix.confirm("Do you really want to delete it?", "confirm-warning")
                                .then(function(result){
                                    $$("form_photo").setValue("/html/assets/img/avatar.png");
                                })
                                .fail(function(){
                                });
                            }},
                        ]
                    },
                    {}
                ],
            },
        ]
    };
    function showForm(winId, node) {
        $$(winId).getBody().clear();
        $$(winId).show(node);
        $$(winId).getBody().focus();
    }
    const password = {
        cols: [
            {
                view: "label",
                label: "Password *",
                gravity: 0.4
            },
            {
                view: "button",
                label: "Change Password",
                click: function (id, event) {
                    showForm("change_password")
                }
            },
            {}
        ]

    };
    const business_code_input = {
        view: "text",
        type: "text",
        name: "business_code",
        label: "Business code",
        id: "business_code",
        placeholder: "Enter Business Code",
        required: true,
        validate: webix.rules.isNotEmpty,
        invalidMessage: "Please enter your Business Code!",
        on: {
            "onBlur": function () {
                var result = this.validate()    
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("kind_hen").focus();
                }

            }
        },
    };
    const kind_hen = {
        view: "richselect",
        label: "Kind of hen",
        name: "kind_hen",
        id: "kind_hen",
        required: true,
        value: 1, options: [
            { "id": 1, "value": "kind 1" },
            { "id": 2, "value": "kind 2" },
            { "id": 3, "value": "kind 3" }
        ],
    }
    const kind_building = {
        view: "radio",
        name: "kind_building",
        id: "kind_building",
        label: "Kind of building",
        value: 1, options: [
            { "id": 1, "value": "normal" },
            { "id": 2, "value": "pannel" },
            { "id": 3, "value": "textile" },
        ],
    }
    const outer = {
        view: "radio",
        name: "outer",
        id: "outer",
        label: "Outer (Roof)",
        value: 1, options: [
            { "id": 1, "value": "yes" },
            { "id": 2, "value": "no" },
            { "id": 3, "value": "both" },
        ],
    }
    const permission_date = {
        view:"datepicker", 
        name: "permission_date",
        id: "permission_date",
        value: new Date(2012, 6, 8), 
        label: "Permission Date", 
        timepicker: false,
    };
    const capacity_breed = {
        view: "text",
        type: "text",
        name: "capacity_breed",
        label: "Capacity Breed",
        id: "capacity_breed",
        placeholder: "Enter Capacity Breed",
        required: true,
        validate: webix.rules.isNotEmpty,
        attributes: {type: "number"},
        invalidMessage: "Please enter your Capacity Breed!",
        on: {
            "onBlur": function () {
                var result = this.validate()    
            },
            "onKeyPress": function (key, e) {
                if (key == 13) {
                    $$("is_ict").focus();
                }

            }
        },
    };
    const is_ict = {
        view: "switch", 
        name: "is_ict",
        value: 1, 
        label:"ICT",
    };
    const change_password_form = {
        view: "form",
        borderless: true,
        elements: [
            { view: "text", type: "password", label: 'Using Password', name: "current_password", id: "current_password", invalidMessage: "please input current password!" },
            { view: "text", type: "password", label: 'New Password', name: "new_password", id: "new_password", invalidMessage: "please input new password!"},
            { view: "text", type: "password", label: 'Confirm Password', name: "confirm_password", id: "confirm_password", invalidMessage: "please input new password correct!"},
            {
                cols: [
                    {
                        view: "button", value: "Save", id: "submit_btn", click: function () {
                            if (this.getParentView().getParentView().validate()) { 
                                const form_value = this.getParentView().getParentView().getValues();

                                webix.ajax().post(schedulerUrl + 'users/' + user.user_id + '/changePassword', {
                                    current_password: form_value.current_password,
                                    new_password: form_value.new_password
                                }).then(function(res) {
                                    switch (res.text()) {
                                        case "error":
                                            webix.alert("Your current password is incorrect! please try again!","alert-error");
                                            break;
                                        case "success":
                                            webix.alert("Your current password is changed!","alert-success").then(function(result){
                                                $$("submit_btn").getTopParentView().hide();
                                            });
                                            
                                            break;
                                    }
                                })
                            }
                        }
                    },
                    {
                        view: "button", value: "Cancel", click: function () {
                            this.getTopParentView().hide(); 
                        }
                    }
                ]
            }
        ],
        rules: {
            current_password: webix.rules.isNotEmpty,
            new_password: webix.rules.isNotEmpty,
            confirm_password:function(value){
                if ( value == "" || value != $$("new_password").getValue()){
                    return false;
                }
                return true;
            }
        },
        elementsConfig: {
            labelPosition: "top",
        }
    };
    webix.ui({
        view: "window",
        id: "change_password",
        position: "center",
        modal: true,
        close: true,
        head: "Change Password",
        body: webix.copy(change_password_form)
    });
    const register_farm_page = {
        view: "form",
        id: "register-farm",
        elementsConfig: {
            bottomPadding: 18,
            labelWidth: 130,
            padding: 10
        },
        elements: [
            {
                view: "text",
                id: "farm_id",
                name: "id",
                hidden: true
            },
            {
                align: "right",
                body: {
                    cols: [
                        { 
                            type: "section",
                            borderless: true,
                            cols:[
                                { 
                                    view:"icon", icon:"mdi mdi-plus",
                                    click: function() {
                                        $$("register-farm").clear();
                                        $$("farm_id").setValue("");
                                        $$("form_photo").setValue("/html/assets/img/avatar.png");
                                    }
                                },
                                { 
                                    view:"icon", icon:"mdi mdi-pencil",
                                    click: function() {
                                        const farm = sessionStorage.getItem("user_group_idx");
                                        if (farm) {
                                            webix.ajax().get(schedulerUrl + "farms/select", {
                                                id: farm
                                            }).then(function(data) {
                                                const farm_info = data.json();
                                                $$("farm_code1").setValue(farm_info.farm_code);
                                                $$("farm_code2").setValue(farm_info.vete_code);
                                                $$("business_code").setValue(farm_info.business_code);
                                                $$("farm_name").setValue(farm_info.farm_name);
                                                $$("farm_address").setValue(farm_info.farm_addr1);
                                                $$("farm_address2").setValue(farm_info.farm_addr2);
                                                $$("ownership").setValue(farm_info.owned);
                                                $$("kind_farm").setValue(farm_info.farm_kind);
                                                $$("employee_domestic").setValue(farm_info.employee_domes);
                                                $$("employee_foreigner").setValue(farm_info.employee_forign);
                                                $$("partner").setValue(farm_info.partner_company);
                                                $$("windows").setValue(farm_info.window_type);
                                                $$("carridor").setValue(farm_info.wast_type);
                                                $$("building_num").setValue(farm_info.building_num);
                                                $$("kind_building").setValue(farm_info.building_type);
                                                $$("outer").setValue(farm_info.outer_type);
                                                $$("permission_date").setValue(new Date(farm_info.permission_date));
                                                $$("capacity_breed").setValue(farm_info.capacity_breed);
                                                $$("is_ict").setValue(farm_info.is_ict);
                                                $$("avatar").setValue(farm_info.avatar);
                                                $$("form_photo").setValue(schedulerUrl + "avatars/farm/" + farm_info.avatar);
                                                $$("farm_id").setValue(farm_info.id);
                                            });
                                        }
                                        else {
                                            $$("menu_list").select("dashboard1");
                                            $$("menu_list").open($$("menu_list").getParentId("dashboard1"));
                                        }
                                    }
                                },
                                { 
                                    view:"icon", icon:"mdi mdi-delete",
                                    click: function() {
                                        webix.confirm("Do you want to delete current farm?", "confirm-warning")
                                        .then(function(result){
                                            const farm = sessionStorage.getItem("user_group_idx");
                                            webix.ajax().del(schedulerUrl + "farms/remove?id=" + farm).then(function(result) {
                                                if (result.text() != "") {
                                                    sessionStorage.clear();
                                                    window.location.href = "login";
                                                }
                                            })
                                        })
                                    }
                                }
                            ],
                            gravity: 0.2
                        }
                    ]
                }
                
            },
            {
                cols: [
                    neccessary_label,
                    save_farm_button,
                ]
            },
            {
                cols: [
                    {
                        rows: [
                            farm_code1_input,
                            farm_code2_input,
                            farm_name_input,
                            kind_farm,
                            {
                                cols: [
                                    farm_address_label,
                                    farm_address
                                ]
                            },
                            farm_address2_input,
                            ownership,
                            building_num_input,
                            employees,
                            partner_input,
                            windows,
                            carridor
                        ],
                    },
                    {
                        rows: [
                            user_avatar,
                            password,
                            business_code_input,
                            kind_hen,
                            kind_building,
                            outer,
                            permission_date,
                            capacity_breed,
                            is_ict
                        ],
                    },
                ]
            },
            {}
        ]
    };
    // ----------- Register Farm page End ----------------
    // ----------- Register biotype page Start ----------------
    const register_biotype_label = {
        view: "label",
        template: "Register Bio Type Bio - Code",
        css: {
            "font-size": "24px"
        }
    };
    const register_biotype_header = {
        cols : [
            {
                view: "label",
                label: "Register biotype"
            },
            {},
            { 
                align:"right",
                body:{ 
                    view: "search", placeholder: "search", id: "biotype_search", name: "search", icon: "wxi-search" , gravity: 0.1 , width: 200,
                    on:{
                        onChange: function(newValue, oldValue, config){
                            refresh_biotype_grid(newValue);
                        }
                    }
                }
            },
        ]
    };
    const register_biotype_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "date", gravity: 0.1 },
            { view: "label", label: "category", gravity: 0.1 },
            { view: "label", label: "biotype code", gravity: 0.1 },
            { view: "label", label: "description", gravity: 0.1 },
            { gravity: 0.1}
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    };
    const register_biotype_form = {
        view: "form",
        id: "register_biotype_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "biotype_id", name: "id" },
            { view: "datepicker", placeholder: "date", id: "date9", name: "date" , gravity: 0.1 },
            { view: "richselect", placeholder: "Bio Category", id: "category", name: "category", gravity: 0.1, options: [
                { id: 1, value: "Chicken for meat" }, 
                { id: 2, value: "Chicken for Egg" },
                { id: 3, value: "Chicken for BirthEgg" },
            ]},
            { view: "text", placeholder: "biotype code name", id: "name1", name: "name" , gravity: 0.1 },
            { view: "text", placeholder: "biotype code description", id: "description1", name: "description", gravity: 0.1 },
            {
                view: "button", value: "Register", id: "register_biotype_button", gravity: 0.1,
                click: function() {
                    if ($$("register_biotype_form").validate()) {
                        const val = $$("register_biotype_form").getValues();
                        const user_idx = user.id;
                        const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                        
                        webix.ajax().post(schedulerUrl + "biotypes/register", {
                            id: val.id,
                            user_idx: user_idx,
                            farm_idx: user_group_idx,
                            date: val.date,
                            category: val.category,
                            name: val.name,
                            description: val.description
                        }).then(function(data) {
                            const response = data.text();
                            if (response != "") {
                                if (val.id == "" ) {
                                    webix.alert({ title: "Register biotype", type: "alert-success", text: "Register a biotype successfully!" }).then(function (result){
                                        refresh_biotype_grid("");
                                        $$("register_biotype_form").clear();
                                        
                                        webix.ajax().get(schedulerUrl + "biotypes/options?user_idx=" + user.id + "&farm_idx=" + user_group_idx, function(text, data){
                                            var options = data.json();
                                        
                                            var list = $$("biotype").getPopup().getList();
                                            list.clearAll();
                                            list.parse(options);

                                        });
                                    })
                                } else {
                                    webix.alert({ title: "Update biotype", type: "alert-success", text: "Update a biotype successfully!" })
                                    $$("register_biotype_form").clear();
                                    $$("register_biotype_button").setValue("Register");

                                    refresh_biotype_grid("");
                                    webix.ajax().get(schedulerUrl + "biotypes/options?user_idx=" + user.id + "&farm_idx=" + user_group_idx, function(text, data){
                                        var options = data.json();
                                    
                                        var list = $$("biotype").getPopup().getList();
                                        list.clearAll();
                                        list.parse(options);

                                    });
                                }
                            } else {
                                webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                            }
                        })
                    }
                }
            }
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        }
    };
    const register_biotype_list_label = {
        view: "label",
        label: "List of biotype"
    };
    const register_biotype_datatable = {
        view:"datatable",
        id: "biotype_grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"date", header:"Date", fillspace:true },
            { id:"category", header:"Bio Type", fillspace:true, template: function(obj) {
                var result = "";
                switch (obj.partner_category) {
                    case "1":
                        result = "Chicken for meat"
                        break;
                    case "2":
                        result = "Chicken for Egg"
                        break;
                    case "3":
                        result = "Chicken for BirthEgg"
                        break;

                    default:
                        result = "Chicken for meat"
                        break;
                }

                return result;
            }},
            { id:"name", header:"Bio Type Name", fillspace:true },
            { id:"description", header:"Bio Type Description", fillspace:true },
        ],
        url:function(params){
            const user_id = user.id;
            const user_group_idx = sessionStorage.getItem("user_group_idx");
            var data = webix.ajax().sync().get(schedulerUrl + "biotypes/all", {
                user_idx: user_id,
                farm_idx: user_group_idx,
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "biotypes/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_biotype_grid("");
                        
                        const user_group_idx = sessionStorage.getItem("user_group_idx");
                        webix.ajax().get(schedulerUrl + "biotypes/options?user_idx=" + user.id + "&farm_idx=" + user_group_idx, function(text, data){
                            var options = data.json();
                        
                            var list = $$("biotype").getPopup().getList();
                            list.clearAll();
                            list.parse(options);
                        });
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "biotypes/select", {id: id.row}).then(function(result) {
                    const biotype = result.json();
                    $$("date9").setValue(new Date(biotype.date));
                    $$("category").setValue(biotype.category);
                    $$("name1").setValue(biotype.name);
                    $$("description1").setValue(biotype.description);
                    $$("biotype_id").setValue(biotype.id);
                    $$("register_biotype_button").setValue("Update");
                })
            }
        }
    };
    const register_biotype_page = {
        view: "form",
        id: "register-biotype",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_biotype_label,
                    register_biotype_header,
                    register_biotype_label_list,
                    register_biotype_form,
                    register_biotype_list_label,
                    register_biotype_datatable,
                ]
            }
        ],
    };
    // ----------- Register biotype page End ----------------
    // ----------- Register Breed page Start ----------------
    const breed_details = webix.ui({
        view:"window",
        id:"breed_details",
        modal: true,
        move: true,
        position: "center",
        responsive: "a1",
        scroll: true,
        borderless	: 	true,
        autowidth: true,
        width: 1200,
        height: 600,
        elementsConfig: { labelPosition: "left", },
        head: {
            view: "toolbar",
            elements: [
                {
                    view: "label",
                    label: "Breed Details",
                    align: "center",
                },
                { 
                    view: "icon",
                    icon: "wxi-close",
                    hotkey: "esc",
                    width: 40,
                    click: function () {
                        $$("breed_details").hide();
                    },
                },
            ],
        },
        body:{
            view: "form",
            id: "breed_form",
            scroll: true,
            elementsConfig: {
                bottomPadding: 18,
                labelWidth: 100,
            },
            css: {
                margin: "auto!important",
            },
            elements: [
                // {view: "label", label: "farm information"},
                // {
                //     cols: [
                //         {
                //             rows: [
                //                 {view: "text", label: "Farm Name", id: "breed_farm_name", name: "breed_farm_name", readonly:true},
                //                 {view: "text", label: "Province", id: "breed_province", name: "breed_province", readonly:true},
                //                 {view: "text", label: "Mobile", id: "mobile", name: "mobile", readonly:true},
                //                 {view: "text", label: "User ID", id: "user_id", name: "user_id", readonly:true},
                //                 {view: "text", label: "Office", id: "office", name: "office", readonly:true},
                //             ]
                //         },
                //         {
                //             rows: [
                //                 {view: "text", label: "Owner Name", id: "owner_name", name: "owner_name", readonly:true},
                //                 {view: "text", label: "Onwer Addr", id: "owner_addr", name: "owner_addr", readonly:true},
                //                 {view: "text", label: "Number Of Building", id: "building_num1", name: "building_num", readonly:true},
                //                 {view: "text", label: "Password", id: "password", name: "password", readonly:true},
                //             ]
                //         }
                //     ]
                // },
                {view: "label", label: "breed information"},
                {
                    cols: [
                        {
                            rows: [
                                {view: "text", label: "partner", id: "breed_partner", name: "breed_partner", readonly:true},
                                {view: "text", label: "Female Head", id: "breed_female_head", name: "breed_female_head", readonly:true},
                            ]
                        },
                        {
                            rows: [
                                {view: "text", label: "Start date", id: "breed_start_date", name: "breed_start_date", readonly:true},
                                {view: "text", label: "Male Head", id: "breed_male_head", name: "breed_male_head", readonly:true},
                            ]
                        },
                        {
                            rows: [
                                {view: "text", label: "Bio Type", id: "breed_biotype", name: "breed_biotype", readonly:true},
                                {view: "text", label: "Start Weekage", id: "breed_start_weekage", name: "breed_start_weekage", readonly:true},
                            ]
                        },
                    ]
                },
                {
                    cols: [
                        {
                            rows: [
                                {view: "text", label: "Female building1", id: "fe_building1", name: "fe_building1"},
                                {view: "text", label: "Female building2", id: "fe_building2", name: "fe_building2"},
                                {view: "text", label: "Female building3", id: "fe_building3", name: "fe_building3"},
                                {view: "text", label: "Female building4", id: "fe_building4", name: "fe_building4"},
                                {view: "text", label: "Female building5", id: "fe_building5", name: "fe_building5"},
                                {view: "text", label: "Female building6", id: "fe_building6", name: "fe_building6"},
                                {view: "text", label: "Female building7", id: "fe_building7", name: "fe_building7"},
                                {view: "text", label: "Female building8", id: "fe_building8", name: "fe_building8"},
                                {view: "text", label: "Female building9", id: "fe_building9", name: "fe_building9"},
                                {view: "text", label: "Female building10", id: "fe_building10", name: "fe_building10"},
                            ]
                        },
                        {
                            rows: [
                                {view: "text", label: "Male building1", id: "ma_building1", name: "ma_building1"},
                                {view: "text", label: "Male building2", id: "ma_building2", name: "ma_building2"},
                                {view: "text", label: "Male building3", id: "ma_building3", name: "ma_building3"},
                                {view: "text", label: "Male building4", id: "ma_building4", name: "ma_building4"},
                                {view: "text", label: "Male building5", id: "ma_building5", name: "ma_building5"},
                                {view: "text", label: "Male building6", id: "ma_building6", name: "ma_building6"},
                                {view: "text", label: "Male building7", id: "ma_building7", name: "ma_building7"},
                                {view: "text", label: "Male building8", id: "ma_building8", name: "ma_building8"},
                                {view: "text", label: "Male building9", id: "ma_building9", name: "ma_building9"},
                                {view: "text", label: "Male building10", id: "ma_building10", name: "ma_building10"},
                            ]
                        },
                    ],
                },
                {view: "label", label: "cut of farm"},
                {
                    cols: [
                        {view: "datepicker", name: "end_date", id: "end_date", placeholder: "End Date"},
                        {view: "text", name: "out_type", id: "out_type", placeholder: "Out Type"},
                        {view: "text", name: "out_company", id: "out_company", placeholder: "Out Company"},
                    ]
                },
                {
                    cols: [
                        {}, {view: "button", value: "Save"},
                        {view: "button", value: "Cancel"}
                    ]
                },
            ],
            elementsConfig: {
                labelWidth: 120,
                margin: 10
            }
        },
    });
    const register_breed_label = {
        view: "label",
        template: "Breed Information",
        css: {
            "font-size": "24px"
        }
    };
    const register_breed_header = {
        cols : [
            {
                view: "label",
                label: "Register breed"
            },
            {},
            { 
                type: "section",
                borderless: true,
                cols:[
                    {}, { view:"icon", icon:"mdi mdi-printer"},
                    { view:"icon", icon:"mdi mdi-folder-upload"},
                    { view:"icon", icon:"mdi mdi-folder-download"}
                ]
            },
        ]
    };
    const register_breed_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "biotype", gravity: 0.1 },
            { view: "label", label: "breedtype", gravity: 0.1 },
            { view: "label", label: "partner", gravity: 0.1 },
            { view: "label", label: "start_date", gravity: 0.1 },
            // { view: "label", label: "end_date", gravity: 0.1 },
            { view: "label", label: "biocode", gravity: 0.1 },
            { view: "label", label: "female_head", gravity: 0.1 },
            { view: "label", label: "male_head", gravity: 0.1 },
            { view: "label", label: "start_weekage", gravity: 0.1 },
            { gravity: 0.1}
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    };
    const register_breed_form = {
        view: "form",
        id: "breed_register_form",
        margin: 10,
        borderless: true,
        cols: [
            {
                view: "richselect",
                name: "biotype",
                id: "biotype",
                placeholder: "biotype",
                required: true,
                gravity: 0.1,
                options: schedulerUrl + "biotypes/options?user_idx=" + user.id + "&farm_idx=" + sessionStorage.getItem("user_group_idx"),
            },
            { view: "richselect", placeholder: "breedtype", id: "breedtype", name: "breedtype", gravity: 0.1, options: ["order", "own"]},
            { view: "text", placeholder: "partner", id: "partner1", name: "partner", gravity: 0.1 },
            { view: "datepicker", placeholder: "start_date", id: "start_date", name: "start_date", gravity: 0.1 },
            // { view: "datepicker", placeholder: "end_date", id: "end_date1", name: "end_date", gravity: 0.1 },
            { view: "richselect", placeholder: "biocode", id: "biocode", name: "biocode", gravity: 0.1, options: ["AA", "BB", "AB"]},
            { view: "text", placeholder: "female_head", id: "female_head", name: "female_head", gravity: 0.1, attributes:{type:"number"} },
            { view: "text", placeholder: "male_head", id: "male_head", name: "male_head", gravity: 0.1, attributes:{type:"number"} },
            { view: "text", placeholder: "start_weekage", id: "start_weekage", name: "start_weekage", gravity: 0.1, attributes:{type:"number"} },
            { 
                rows: [
                    {
                        view: "button", value: "register",
                        click: function(){
                            if ($$("breed_register_form").validate()) {
                                const val = $$("breed_register_form").getValues();
                                webix.ajax().post(schedulerUrl + "breeds/register", {
                                    user_idx: user.id,
                                    farm_idx: sessionStorage.getItem("user_group_idx"),
                                    biotype: val.biotype,
                                    breedtype: val.breedtype,
                                    partner: val.partner,
                                    start_date: val.start_date,
                                    end_date: val.start_date,
                                    biocode: val.biocode,
                                    female_head: val.female_head,
                                    male_head: val.male_head,
                                    start_weekage: val.start_weekage,
                                    end_weekage: "0"
                                }).then(function(data) {
                                    if (data.text() != "") {
                                        webix.alert({ title: "Register Breed", type: "alert-success", text: "Register a breed successfully!" }).then(function() {
                                            refresh_breed_grid();
                                            $$("breed_register_form").clear();
                                        })
                                    }
                                    else {
                                        webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning" })
                                    }
                                })
                            }
                        }
                    },
                    {}
                ],
                gravity: 0.1,
                css: {
                    "margin": "auto!important",
                    "padding": "20px"
                }
            },
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        }
    };
    const register_breed_list_label = {
        view: "label",
        label: "List of breed"
    };
    const register_breed_datatable = {
        view:"datatable",
        id: "grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"uuid",	header:"Breed Code", fillspace:true },
            { id:"biotype",	header:"Bio Type", fillspace:true  },
            { id:"breedtype",	header:"Breed Type", fillspace:true  },
            { id:"partner",	header:"Partner", fillspace:true  },
            { id:"start_date",	header:"Start Date", fillspace:true  },
            { id:"end_date",	header:"End Date", fillspace:true  },
            { id:"biocode",	header:"Bio Code", fillspace:true  },
            { id:"female_head",	header:"Female Head", fillspace:true  },
            { id:"male_head",	header:"Male Head", fillspace:true  },
            { id:"start_weekage",	header:"Start Weekage", fillspace:true  },
        ],
        url:function(params){
            var user_id = user.id;
            var user_group_idx = sessionStorage.getItem("user_group_idx");
            var data = webix.ajax().sync().get(schedulerUrl + "breeds/all", {
                uID: user_id,
                fID: user_group_idx
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "breeds/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_breed_grid();
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "breeds/select", {id: id.row}).then(function(result) {
                    const breed = JSON.parse(result.text());
                    breed_details.show();
                })
            }
        }
    };
    const register_breed_page = {
        view: "form",
        id: "register-breed",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_breed_label,
                    register_breed_header,
                    register_breed_label_list,
                    register_breed_form,
                    register_breed_list_label,
                    register_breed_datatable,
                ]
            }
        ],
    };
    // ----------- Register Breed page End ----------------
    // ----------- Register authority rule page Start ----------------
    const register_authority_label = {
        view: "label",
        template: "Register Authority Rules",
        css: {
            "font-size": "24px"
        }
    };
    const register_authority_header = {
        cols : [
            {
                view: "label",
                label: "Register authority"
            },
            {},
            { 
                align:"right",
                body:{ 
                    view: "search", placeholder: "search", id: "rule_search", name: "search", icon: "wxi-search" , gravity: 0.1 , width: 200,
                    on:{
                        onChange: function(newValue, oldValue, config){
                            refresh_auth_rule_grid(newValue);
                        }
                    }
                }
            },
        ]
    };
    const register_authority_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "name", gravity: 0.1 },
            { view: "label", label: "value", gravity: 0.1 },
            { view: "label", label: "description", gravity: 0.1 },
            { gravity: 0.1}
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    };
    const register_authority_form = {
        view: "form",
        id: "register_authority_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "rule_id", name: "id" },
            { view: "text", placeholder: "rule name", id: "rule_name", name: "name" , gravity: 0.1 },
            { view: "text", placeholder: "rule value", id: "rule_value", name: "value" , gravity: 0.1 },
            { view: "text", placeholder: "rule description", id: "rule_description", name: "description" , gravity: 0.1 },
            {
                view: "button", value: "Register", id: "register_rule_button", gravity: 0.1,
                click: function() {
                    if ($$("register_authority_form").validate()) {
                        const val = $$("register_authority_form").getValues();
                        
                        webix.ajax().post(schedulerUrl + "auth_rules/register", {
                            id: val.id,
                            name: val.name,
                            value: val.value,
                            description: val.description
                        }).then(function(data) {
                            const response = data.text();
                            if (response != "") {
                                if (val.id == "" ) {
                                    webix.alert({ title: "Register auth_rule", type: "alert-success", text: "Register a auth_rule successfully!" }).then(function (result){
                                        refresh_auth_rule_grid("");
                                        $$("register_authority_form").clear();
                                    })
                                } else {
                                    webix.alert({ title: "Update auth_rule", type: "alert-success", text: "Update a auth_rule successfully!" })
                                    $$("register_authority_form").clear();
                                    $$("register_rule_button").setValue("Register");

                                    refresh_auth_rule_grid("");

                                    webix.ajax().get(schedulerUrl + "biotypes/options?user_idx=" + user.id + "&farm_idx=" + user_group_idx, function(text, data){
                                        var options = data.json();
                                    
                                        var list = $$("biotype").getPopup().getList();
                                        list.clearAll();
                                        list.parse(options);

                                    });
                                }
                            } else {
                                webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                            }
                        })
                    }
                }
            }
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        }
    };
    const register_authority_list_label = {
        view: "label",
        label: "List of authority"
    };
    const register_authority_datatable = {
        view:"datatable",
        id: "auth_rule_grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"name", header:"Rule Name", fillspace:true },
            { id:"value", header:"Rule Value", fillspace:true },
            { id:"description", header:"Rule Description", fillspace:true },
        ],
        url:function(params){
            var data = webix.ajax().sync().get(schedulerUrl + "auth_rules/all").responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "auth_rules/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_auth_rule_grid("");
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "auth_rules/select", {id: id.row}).then(function(result) {
                    const rule = result.json();
                    $$("rule_name").setValue(rule.name);
                    $$("rule_value").setValue(rule.value);
                    $$("rule_description").setValue(rule.description);
                    $$("rule_id").setValue(rule.id);
                    $$("register_rule_button").setValue("Update");
                })
            }
        }
    };
    const register_authority_page = {
        view: "form",
        id: "register-authority",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_authority_label,
                    register_authority_header,
                    register_authority_label_list,
                    register_authority_form,
                    register_authority_list_label,
                    register_authority_datatable,
                ]
            }
        ],
    };
    // ----------- Register authority rule page End ----------------
    // ----------- Register Worker page Start ----------------
    const register_worker_label = {
        view: "label",
        template: "Register worker authority",
        css: {
            "font-size": "24px"
        }
    }
    const register_worker_header = {
        cols : [
            {
                view: "label",
                label: "Register"
            },
            {}
        ]
        
    }
    const register_worker_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "user name", gravity: 0.1 },
            { view: "label", label: "job name", gravity: 0.1 },
            { view: "label", label: "user id", gravity: 0.1 },
            { view: "label", label: "user pass", gravity: 0.1 },
            { view: "label", label: "mobile", gravity: 0.1 },
            { view: "label", label: "rule_idx", gravity: 0.1 },
            { gravity: 0.1 },
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    }
    const register_worker_form = {
        view: "form",
        id: "register_worker_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "worker_id", name: "id" },
            { view: "text", placeholder: "user name", id: "user_name1", name: "user_name", gravity: 0.1},
            { view: "text", placeholder: "job name", id: "job_name", name: "job_name", gravity: 0.1 },
            { 
                cols: [
                    {
                        view: "text", placeholder: "user id", id: "user_id1", name: "user_id" , gravity: 0.8, readonly: true,
                    },
                    {
                        view: "button", value: "cb", gravity: 0.2,
                        click: function() {
                            
                            webix.ajax().post(schedulerUrl + "workers/generate_name", {
                                user_id: user.user_id
                            }).then(function(data) {
                                $$("user_id1").setValue(data.text());    
                            })
                        }
                    }
                ], 
                gravity: 0.1 
            },
            { view: "text", placeholder: "user pass", id: "user_pass1", name: "user_pass", gravity: 0.1 },
            { view: "text", placeholder: "mobile", id: "mobile1", name: "mobile", pattern: { mask: "###-####-####", allow: /[0-9]/g }, gravity: 0.1 },
            {
                view: "multiselect",
                name: "rule_idx",
                id: "rule_idx",
                placeholder: "Rule idx",
                required: true,
                options: schedulerUrl + "auth_rules/options?farm_idx=" + sessionStorage.getItem("user_group_idx"),
                gravity: 0.1,
            },
            { 
                view: "button", value: "register", id: "register_worker_button",
                click: function(){
                    if ($$("register_worker_form").validate()) {
                        const val = $$("register_worker_form").getValues();
                        const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));

                        webix.ajax().post(schedulerUrl + "workers/register", {
                            id: val.id,
                            user_id: val.user_id,
                            user_name: val.user_name,
                            user_pass: val.user_pass,
                            job_name: val.job_name,
                            user_group: "1",
                            user_group_idx: user_group_idx,
                            mobile: val.mobile,
                            rule_idx: val.rule_idx,
                            giver_idx: user.id
                        }).then(function(data) {
                            const response = data.text();
                            if (response != "") {
                                if (val.id == "" ) {
                                    webix.alert({ title: "Register worker", type: "alert-success", text: "Register a worker successfully!" }).then(function (result){
                                        refresh_worker_grid("");
                                        $$("register_worker_form").clear();
                                    })
                                } else {
                                    webix.alert({ title: "Update worker", type: "alert-success", text: "Update a worker successfully!" })
                                    $$("register_worker_form").clear();
                                    $$("register_worker_button").setValue("Register");

                                    refresh_worker_grid("");
                                }
                            } else {
                                webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                            }
                        })
                    }
                },
                gravity: 0.1,
                css: {
                    "margin": "auto!important",
                    "padding": "20px"
                }
            },
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        },
        gravity: 0.2
    }
    const register_worker_list_label = {
        view: "label",
        label: "List of workers"
    }
    const register_worker_datatable = {
        view:"datatable",
        id: "worker_grid",
        autoConfig:true,
        scroll: "x",
        resizeColumn:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"user_name",	header:"user_name", fillspace:true },
            { id:"job_name",	header:"job_name", fillspace:true  },
            { id:"user_id",	header:"user_id", fillspace:true  },
            { id:"user_pass",	header:"user_pass", fillspace:true  },
            { id:"mobile",	header:"mobile", fillspace:true  },
            { id:"rule_idx",	header:"rule_idx", fillspace: true },
        ],
        url:function(params){
            var user_id = user.id;
            var user_group_idx = sessionStorage.getItem("user_group_idx");
            var data = webix.ajax().sync().get(schedulerUrl + "workers/all", {
                uID: user_id,
                fID: user_group_idx
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "workers/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_worker_grid();
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "workers/select", {id: id.row}).then(function(result) {
                    const worker = result.json();
                    $$("user_name1").setValue(worker.user_name);
                    $$("job_name").setValue(worker.job_name);
                    $$("user_id1").setValue(worker.user_id);
                    $$("user_pass1").setValue(worker.user_pass);
                    $$("mobile1").setValue(worker.mobile);
                    $$("rule_idx").setValue(worker.rule_idx);
                    $$("worker_id").setValue(worker.id);
                    $$("register_worker_button").setValue("Update");
                })
            }
        }
    };
    const register_worker_page = {
        view: "form",
        id: "register-worker",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_worker_label,
                    register_worker_header,
                    register_worker_label_list,
                    register_worker_form,
                    register_worker_list_label,
                    register_worker_datatable,
                ]
            }
        ],
    };
    // ----------- Register Worker page End ----------------
    // ----------- Register fmn code modal Start ----------------
    const register_fmn_label = {
        view: "label",
        template: "Register Food & Medicine & Nutrition & Etc",
        css: {
            "font-size": "24px"
        }
    };
    const register_fmn_header = {
        cols : [
            {
                view: "label",
                label: "Register fmn code"
            },
            {},
            { 
                align:"right",
                body:{ 
                    view: "search", placeholder: "search", id: "fmn_search", name: "search", icon: "wxi-search" , gravity: 0.1 , width: 200,
                    on:{
                        onChange: function(newValue, oldValue, config){
                            refresh_fmn_code_grid(newValue);
                        }
                    }
                }
            },
        ]
    };
    const register_fmn_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "date", gravity: 0.1 },
            { view: "label", label: "type", gravity: 0.1 },
            { view: "label", label: "name", gravity: 0.1 },
            { view: "label", label: "provider", gravity: 0.1 },
            { view: "label", label: "description", gravity: 0.1 },
            { gravity: 0.1}
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    };
    const register_fmn_form = {
        view: "form",
        id: "register_fmn_code_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "fmn_id", name: "id" },
            { view: "datepicker", placeholder: "date", id: "date7", name: "date" , gravity: 0.1 },
            { view: "richselect", placeholder: "item type", id: "type", name: "type", gravity: 0.1, options: [
                { id: 1, value: "Food" }, 
                { id: 2, value: "Medicine" },
                { id: 3, value: "nutrition" },
                { id: 4, value: "quarantine" },
            ]},
            { view: "text", placeholder: "item name", id: "name", name: "name" , gravity: 0.1 },
            { view: "richselect", placeholder: "provider", id: "provider", name: "provider", gravity: 0.1, options: [
                { id: 1, value: "Partner1" }, 
                { id: 2, value: "Partner2" },
                { id: 3, value: "Partner3" },
                { id: 4, value: "Partner4" },
            ]},
            { view: "text", placeholder: "item description", id: "description", name: "description", gravity: 0.1 },
            {
                view: "button", value: "Register", id: "register_fmn_button", gravity: 0.1,
                click: function() {
                    if ($$("register_fmn_code_form").validate()) {
                        const val = $$("register_fmn_code_form").getValues();
                        const user_idx = user.id;
                        const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                        
                        webix.ajax().post(schedulerUrl + "fmn_codes/register", {
                            id: val.id,
                            user_idx: user_idx,
                            farm_idx: user_group_idx,
                            date: val.date,
                            type: val.type,
                            name: val.name,
                            provider: val.provider,
                            description: val.description,
                        }).then(function(data) {
                            const response = data.text();
                            if (response != "") {
                                if (val.id == "" ) {
                                    webix.alert({ title: "Register fmn code item", type: "alert-success", text: "Register a fmn code successfully!" }).then(function (result){
                                        refresh_fmn_code_grid("");
                                        $$("register_fmn_code_form").clear();
                                    })
                                } else {
                                    webix.alert({ title: "Update fmn code", type: "alert-success", text: "Update a fmn code successfully!" })
                                    $$("register_fmn_code_form").clear();
                                    $$("register_fmn_button").setValue("Register");

                                    refresh_fmn_code_grid("");
                                }
                            } else {
                                webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                            }
                        })
                    }
                }
            }
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        }
    };
    const register_fmn_list_label = {
        view: "label",
        label: "List of fmn code"
    };
    const register_fmn_datatable = {
        view:"datatable",
        id: "fmn_code_grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"date",    header:"Date", fillspace:true },
            { id:"name",    header:"Item Name", fillspace:true },
            { id:"code",    header:"Item Code", fillspace:true },
            { id:"provider",    header:"Provider", fillspace:true, template: function(obj) {
                var result = "";
                switch (obj.provider) {
                    case "1":
                        result = "Partner1"
                        break;
                    case "2":
                        result = "Partner2"
                        break;
                    case "3":
                        result = "Partner3"
                        break;
                    case "4":
                        result = "Partner4"
                        break;
                    default:
                        result = "Partner1"
                        break;
                }

                return result;
            }},
            { id:"description", header:"Item Description", fillspace:true  },
        ],
        url:function(params){
            const user_id = user.id;
            const user_group_idx = sessionStorage.getItem("user_group_idx");
            var data = webix.ajax().sync().get(schedulerUrl + "fmn_codes/all", {
                user_idx: user_id,
                farm_idx: user_group_idx,
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "fmn_codes/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_fmn_code_grid("");
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "fmn_codes/select", {id: id.row}).then(function(result) {
                    const fmn = result.json();
                    console.log(fmn);
                    $$("date7").setValue(new Date(fmn.date));
                    $$("type").setValue(fmn.type);
                    $$("name").setValue(fmn.name);
                    $$("provider").setValue(fmn.provider);
                    $$("description").setValue(fmn.description);
                    $$("fmn_id").setValue(fmn.id);
                    $$("register_fmn_button").setValue("Update");
                })
            }
        }
    };
    const register_fmn_page = {
        view: "form",
        id: "register-fmn",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_fmn_label,
                    register_fmn_header,
                    register_fmn_label_list,
                    register_fmn_form,
                    register_fmn_list_label,
                    register_fmn_datatable,
                ]
            }
        ],
    };
    // ----------- Register fmn code End ----------------
    // ----------- Register Nutri page Start ----------------
    const register_nutri_label = {
        view: "label",
        template: "Medicine Investory",
        css: {
            "font-size": "24px"
        }
    }
    const register_nutri_header = {
        cols : [
            {
                view: "label",
                label: "Register"
            },
            {}
        ]
        
    }
    const register_nutri_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "name(code)", gravity: 0.1 },
            { view: "label", label: "date", gravity: 0.1 },
            { view: "label", label: "med_type", gravity: 0.1 },
            { view: "label", label: "measure_unit", gravity: 0.1 },
            { view: "label", label: "measure", gravity: 0.1 },
            { view: "label", label: "in_qnty", gravity: 0.1 },
            { view: "label", label: "unit_price", gravity: 0.1 },
            { view: "label", label: "max_qnty", gravity: 0.1 },
            { gravity: 0.1 },
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    }
    const register_nutri_form = {
        view: "form",
        id: "register_nutri_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "nutri_id", name: "id" },
            { view: "text", placeholder: "name", id: "code", name: "code" , gravity: 0.1},
            { view: "datepicker", placeholder: "date", id: "date2", name: "date" , gravity: 0.1 },
            { view: "richselect", placeholder: "med_type", id: "med_type", name: "med_type", gravity: 0.1, options: ["medi", "non-medi", "food-nutri"]},
            { view: "text", placeholder: "measure_unit", id: "measure_unit", name: "measure_unit" , gravity: 0.1, attributes:{type:"number"}},
            { view: "richselect", placeholder: "measure", id: "measure", name: "measure", gravity: 0.1, options: ["ml", "l", "gram", "kg", "pcs"]},
            { view: "text", placeholder: "in_qnty", id: "in_qnty", name: "in_qnty" , gravity: 0.1, attributes:{type:"number"}},
            { view: "text", placeholder: "unit_price", id: "unit_price", name: "unit_price" , gravity: 0.1, attributes:{type:"number"}},
            { view: "text", placeholder: "max_qnty", id: "max_qnty", name: "max_qnty" , gravity: 0.1, attributes:{type:"number"}},
            { 
                rows: [
                    {
                        view: "button", value: "Register", id: "register_mednutri_button",
                        click: function(){
                            if ($$("register_nutri_form").validate()) {
                                const val = $$("register_nutri_form").getValues();
                                const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                                const breed_code = JSON.parse(sessionStorage.getItem("breed_code"));

                                webix.ajax().post(schedulerUrl + "mednutri/register", {
                                    id: val.id,
                                    user_idx: user.id,
                                    farm_idx: user_group_idx,
                                    breed_code: breed_code,
                                    code: val.code,
                                    date: val.date,
                                    med_type: val.med_type,
                                    measure_unit: val.measure_unit,
                                    measure: val.measure,
                                    in_qnty: val.in_qnty,
                                    unit_price: val.unit_price,
                                    max_qnty: val.max_qnty
                                }).then(function(data) {
                                    const response = data.text();
                                    if (response != "") {
                                        if (val.id == "" ) {
                                            webix.alert({ title: "Register Nutri", type: "alert-success", text: "Register a nutri successfully!" }).then(function (result){
                                                $$("register_nutri_form").clear();
                                                refresh_medi_grid();
                                                refresh_non_medi_grid();
                                                refresh_food_nutri_grid();
                                            })
                                        } else {
                                            webix.alert({ title: "Update Nutri", type: "alert-success", text: "Update a nutri successfully!" }).then(function (result){
                                                $$("register_nutri_form").clear();
                                                $$("register_mednutri_button").setValue("Register");
                                                refresh_medi_grid();
                                                refresh_non_medi_grid();
                                                refresh_food_nutri_grid();
                                            })
                                        }
                                    } else {
                                        webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                                    }
                                })
                            }
                        }
                    },
                    {}
                ],
                gravity: 0.1,
                css: {
                    "margin": "auto!important",
                    "padding": "20px"
                }
            },
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        },
        gravity: 0.2
    }
    const register_medi_list_label = {
        view: "label",
        label: "List of medi"
    }
    const register_medi_list = {
        view:"datatable",
        id: "medi_grid",
        autoConfig:true,
        height: 300,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"code",	header:"Name", fillspace:true },
            { id:"date",	header:"date", fillspace:true  },
            { id:"inventory",	header:"inventory", fillspace:4, 
                template: function(obj) {
                    var percent = parseFloat(obj.in_qnty) / parseFloat(obj.max_qnty) * 100;
                    return `<div class="medi_inventory">
                        <span style="width: 50px; text-align: right;">0</span>
                        <input type="range" min="1" max="100" value="${percent}" class="slider" id="myRange" disabled="true" title="${percent}%">
                        <span style="width: 50px;">100%</span>
                    </div>` 
                }
            },
            { id:"amount",	header:"amount", fillspace:true, template: function(obj) {
                return parseInt(obj.in_qnty) * parseInt(obj.unit_price);
            }},
        ],
        url:function(params){
            var user_id = user.id;
            var user_group_idx = sessionStorage.getItem("user_group_idx");
            var breed_code = sessionStorage.getItem("breed_code");
            var data = webix.ajax().sync().get(schedulerUrl + "mednutri/all", {
                uID: user_id,
                fID: user_group_idx,
                breed_code: breed_code,
                med_type: "medi"
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "mednutri/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_medi_grid();
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "mednutri/select", {id: id.row}).then(function(result) {
                    const medi = result.json();
                    $$("code").setValue(medi.code);
                    $$("date2").setValue(new Date(medi.date));
                    $$("med_type").setValue(medi.med_type);
                    $$("measure_unit").setValue(medi.measure_unit);
                    $$("measure").setValue(medi.measure);
                    $$("in_qnty").setValue(medi.in_qnty);
                    $$("unit_price").setValue(medi.unit_price);
                    $$("max_qnty").setValue(medi.max_qnty);
                    $$("nutri_id").setValue(medi.id);
                    $$("register_mednutri_button").setValue("Update");
                })
            }
        }
    }
    const register_non_medi_list_label = {
        view: "label",
        label: "List of non medi"
    }
    const register_non_medi_list = {
        view:"datatable",
        id: "non_medi_grid",
        autoConfig:true,
        height: 300,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"code",	header:"Name", fillspace:true },
            { id:"date",	header:"date", fillspace:true  },
            { id:"inventory",	header:"inventory", fillspace:4, 
                template: function(obj) {
                    var percent = parseFloat(obj.in_qnty) / parseFloat(obj.max_qnty) * 100;
                    return `<div class="medi_inventory">
                        <span style="width: 50px; text-align: right;">0</span>
                        <input type="range" min="1" max="100" value="${percent}" class="slider" id="myRange" disabled="true" title="${percent}%">
                        <span style="width: 50px;">100%</span>
                    </div>` 
                }
            },
            { id:"amount",	header:"amount", fillspace:true, template: function(obj) {
                return parseInt(obj.in_qnty) * parseInt(obj.unit_price);
            }},
        ],
        url:function(params){
            var user_id = user.id;
            var user_group_idx = sessionStorage.getItem("user_group_idx");
            var breed_code = sessionStorage.getItem("breed_code");
            var data = webix.ajax().sync().get(schedulerUrl + "mednutri/all", {
                uID: user_id,
                fID: user_group_idx,
                breed_code: breed_code,
                med_type: "non-medi"
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "mednutri/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_medi_grid();
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "mednutri/select", {id: id.row}).then(function(result) {
                    const medi = result.json();
                    $$("code").setValue(medi.code);
                    $$("date2").setValue(new Date(medi.date));
                    $$("med_type").setValue(medi.med_type);
                    $$("measure_unit").setValue(medi.measure_unit);
                    $$("measure").setValue(medi.measure);
                    $$("in_qnty").setValue(medi.in_qnty);
                    $$("unit_price").setValue(medi.unit_price);
                    $$("max_qnty").setValue(medi.max_qnty);
                    $$("nutri_id").setValue(medi.id);
                    $$("register_mednutri_button").setValue("Update");
                })
            }
        }
    }
    const register_food_nutri_list_label = {
        view: "label",
        label: "List of food nutri"
    }
    const register_food_nutri_list = {
        view:"datatable",
        id: "food_nutri_grid",
        autoConfig:true,
        height: 300,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"code",	header:"Name", fillspace:true },
            { id:"date",	header:"date", fillspace:true  },
            { id:"inventory",	header:"inventory", fillspace:4, 
                template: function(obj) {
                    var percent = parseFloat(obj.in_qnty) / parseFloat(obj.max_qnty) * 100;
                    return `<div class="medi_inventory">
                        <span style="width: 50px; text-align: right;">0</span>
                        <input type="range" min="1" max="100" value="${percent}" class="slider" id="myRange" disabled="true" title="${percent}%">
                        <span style="width: 50px;">100%</span>
                    </div>` 
                }
            },
            { id:"amount",	header:"amount", fillspace:true, template: function(obj) {
                return parseInt(obj.in_qnty) * parseInt(obj.unit_price);
            }},
        ],
        url:function(params){
            var user_id = user.id;
            var user_group_idx = sessionStorage.getItem("user_group_idx");
            var breed_code = sessionStorage.getItem("breed_code");
            var data = webix.ajax().sync().get(schedulerUrl + "mednutri/all", {
                uID: user_id,
                fID: user_group_idx,
                breed_code: breed_code,
                med_type: "food-nutri"
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "mednutri/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_medi_grid();
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "mednutri/select", {id: id.row}).then(function(result) {
                    const medi = result.json();
                    $$("code").setValue(medi.code);
                    $$("date2").setValue(new Date(medi.date));
                    $$("med_type").setValue(medi.med_type);
                    $$("measure_unit").setValue(medi.measure_unit);
                    $$("measure").setValue(medi.measure);
                    $$("in_qnty").setValue(medi.in_qnty);
                    $$("unit_price").setValue(medi.unit_price);
                    $$("max_qnty").setValue(medi.max_qnty);
                    $$("nutri_id").setValue(medi.id);
                    $$("register_mednutri_button").setValue("Update");
                })
            }
        }
    }
    const register_nutri_page = {
        view: "form",
        id: "register-nutri",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_nutri_label,
                    register_nutri_header,
                    register_nutri_label_list,
                    register_nutri_form,
                    register_medi_list_label,
                    register_medi_list,
                    register_non_medi_list_label,
                    register_non_medi_list,
                    register_food_nutri_list_label,
                    register_food_nutri_list
                ]
            }
        ],
    };
    // ----------- Register Nutri page End ----------------
    // ----------- Register Food page Start ----------------
    const register_food_label = {
        view: "label",
        template: "Food Investory",
        css: {
            "font-size": "24px"
        }
    }
    const register_food_header = {
        cols : [
            {
                view: "label",
                label: "Food Register"
            },
            {}
        ]
        
    }
    const register_food_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "food name", gravity: 0.1 },
            { view: "label", label: "sex", gravity: 0.1 },
            { view: "label", label: "date", gravity: 0.1 },
            { view: "label", label: "in_kg", gravity: 0.1 },
            { view: "label", label: "unit_price", gravity: 0.1 },
            { view: "label", label: "tank_max", gravity: 0.1 },
            { view: "label", label: "nutrition_name", gravity: 0.1 },
            { view: "label", label: "nutrition_in_kg", gravity: 0.1 },
            { gravity: 0.1 },
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    }
    const register_food_form = {
        view: "form",
        id: "register_food_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "food_id", name: "id" },
            { view: "text", placeholder: "name", id: "food_name", name: "code" , gravity: 0.1},
            { view: "richselect", placeholder: "Sex", id: "sex", name: "sex", gravity: 0.1, options: [{id: 1, value: "female"}, {id: 2, value: "male"}]},
            { view: "datepicker", placeholder: "date", id: "date3", name: "date" , gravity: 0.1 },
            { view: "text", placeholder: "in_kg", id: "in_kg", name: "in_kg" , gravity: 0.1, attributes:{type:"number"}},
            { view: "text", placeholder: "unit_price", id: "unit_price1", name: "unit_price" , gravity: 0.1, attributes:{type:"number"}},
            { view: "text", placeholder: "tank_max", id: "tank_max", name: "tank_max" , gravity: 0.1, attributes:{type:"number"}},
            { view: "multiselect", placeholder: "nutrition_name", id: "nutrition_name", name: "nutrition_name", gravity: 0.1, options: ["nut1", "nut2", "nut3", "nut4"]},
            { view: "text", placeholder: "nutrition_in_kg", id: "nutrition_in_kg", name: "nutrition_in_kg" , gravity: 0.1, attributes:{type:"number"}},
            { 
                rows: [
                    {
                        view: "button", value: "register", id: "register_food_button",
                        click: function(){
                            if ($$("register_food_form").validate()) {
                                const val = $$("register_food_form").getValues();
                                const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                                const breed_code = JSON.parse(sessionStorage.getItem("breed_code"));

                                webix.ajax().post(schedulerUrl + "foods/register", {
                                    user_idx: user.id,
                                    farm_idx: user_group_idx,
                                    breed_code: breed_code,
                                    date: val.date,
                                    code: val.code,
                                    in_kg: val.in_kg,
                                    unit_price: val.unit_price,
                                    sex: val.sex,
                                    tank_max: val.tank_max,
                                    nutrition_name: val.nutrition_name,
                                    nutrition_in_kg: val.nutrition_in_kg
                                }).then(function(data) {
                                    const response = data.text();
                                    if (response == "success") {
                                        webix.alert({ title: "Register Food", type: "alert-success", text: "Register a food successfully!" }).then(function (result){
                                            refresh_food_grid();
                                            $$("register_food_form").clear();
                                        })
                                    } else {
                                        webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                                    }
                                })
                            }
                        }
                    },
                    {}
                ],
                gravity: 0.1,
                css: {
                    "margin": "auto!important",
                    "padding": "20px"
                }
            },
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        },
        gravity: 0.2
    }
    const register_food_list_label = {
        view: "label",
        label: "Food List"
    }
    const register_food_datatable = {
        view:"datatable",
        id: "food_grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"code",	header:"Food Name"},
            { id:"date",	header:"Date"},
            { 
                id:"in_kg",	header:"Food Inventory Graph", fillspace:true,
                template: function(obj) {
                    var percent = parseFloat(obj.in_kg) / parseFloat(obj.tank_max) * 100;
                    return `<div class="medi_inventory">
                        <span style="width: 50px; text-align: right;">0</span>
                        <input type="range" min="1" max="100" value="${percent}" class="slider" id="myRange" disabled="true" title="${percent}%">
                        <span style="width: 50px;">100%</span>
                    </div>` 
                }
            },
            { id:"unit_price",	header:"Amount", template: function(obj) {
                return parseInt(obj.in_kg) * parseInt(obj.unit_price);
            }},
        ],
        url:function(params){
            var user_id = user.id;
            var user_group_idx = sessionStorage.getItem("user_group_idx");
            var breed_code = sessionStorage.getItem("breed_code");
            var data = webix.ajax().sync().get(schedulerUrl + "foods/all", {
                uID: user_id,
                fID: user_group_idx,
                breed_code: breed_code
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "foods/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_food_grid();
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "foods/select", {id: id.row}).then(function(result) {
                    const food = result.json();
                    $$("food_name").setValue(food.code);
                    $$("sex").setValue(new Date(food.sex));
                    $$("date3").setValue(food.date);
                    $$("in_kg").setValue(food.in_kg);
                    $$("unit_price1").setValue(food.unit_price);
                    $$("tank_max").setValue(food.tank_max);
                    $$("nutrition_name").setValue(food.nutrition_name);
                    $$("nutrition_in_kg").setValue(food.nutrition_in_kg);
                    $$("food_id").setValue(food.id);
                    $$("register_food_button").setValue("Update");
                })
            }
        },
    }
    const register_food_page = {
        view: "form",
        id: "register-food",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_food_label,
                    register_food_header,
                    register_food_label_list,
                    register_food_form,
                    register_food_list_label,
                    register_food_datatable,
                ]
            }
        ],
    };
    // ----------- Register Food page End ----------------
    // ----------- Register sale item modal Start ----------------
    const register_sale_item_label = {
        view: "label",
        template: "Register sale item code",
        css: {
            "font-size": "24px"
        }
    };
    const register_sale_item_header = {
        cols : [
            {
                view: "label",
                label: "Register sale_item code"
            },
            {},
        ]
    };
    const register_sale_item_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "name", gravity: 0.1 },
            { view: "label", label: "description", gravity: 0.1 },
            { gravity: 0.1}
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    };
    const register_sale_item_form = {
        view: "form",
        id: "register_sale_item_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "sale_item_id", name: "id" },
            { view: "text", id: "item_name", placeholder: "item_name", name: "item_name"},
            { view: "text", id: "item_description", placeholder: "item_description", name: "item_description" },
            {
                view: "button", value: "Register", id: "register_sale_item_button",
                click: function() {
                    if ($$("register_sale_item_form").validate()) {
                        const val = $$("register_sale_item_form").getValues();
                        const user_idx = user.id;
                        const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                        const breed_code = JSON.parse(sessionStorage.getItem("breed_code"));
                        
                        webix.ajax().post(schedulerUrl + "sales/items/register", {
                            id: val.id,
                            user_idx: user_idx,
                            farm_idx: user_group_idx,
                            breed_code: breed_code,
                            date: new Date(),
                            item_name: val.item_name,
                            item_description: val.item_description,
                        }).then(function(data) {
                            const response = data.text();
                            const user_group_idx = sessionStorage.getItem("user_group_idx");
                            if (response != "") {
                                if (val.id == "" ) {
                                    webix.alert({ title: "Register sales item", type: "alert-success", text: "Register a sales item successfully!" }).then(function (result){
                                        refresh_sale_item_grid();
                                        $$("register_sale_item_form").clear();
                                        webix.ajax().get(schedulerUrl + "sales/items/options?user_idx=" + user.id +"&farm_idx=" + user_group_idx, function(text, data){
                                            var options = data.json();
                                        
                                            var list = $$("sales_item").getPopup().getList();
                                            list.clearAll();
                                            list.parse(options);

                                        });
                                    })
                                } else {
                                    webix.alert({ title: "Update sales item", type: "alert-success", text: "Update a sales item successfully!" })
                                    $$("register_sale_item_form").clear();
                                    $$("register_sale_item_button").setValue("Register");

                                    refresh_sale_item_grid("");
                                    webix.ajax().get(schedulerUrl + "sales/items/options?user_idx=" + user.id + "&farm_idx=" + user_group_idx, function(text, data){
                                        var options = data.json();
                                    
                                        var list = $$("sales_item").getPopup().getList();
                                        list.clearAll();
                                        list.parse(options);

                                    });
                                }
                            } else {
                                webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                            }
                        })
                    }
                }
            }
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        }
    };
    const register_sale_item_list_label = {
        view: "label",
        label: "List of sale_item code"
    };
    const register_sale_item_datatable = {
        view:"datatable",
        id: "sale_item_grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"date",    header:"Date", fillspace:true },
            { id:"item_name",   header:"Item Name", fillspace:true },
            { id:"item_description",    header:"Item Description", fillspace:true  },
        ],
        url:function(params){
            const user_id = user.id;
            const user_group_idx = sessionStorage.getItem("user_group_idx");
            const breed_code = sessionStorage.getItem("breed_code");
            var data = webix.ajax().sync().get(schedulerUrl + "sales/items/all", {
                user_idx: user_id,
                farm_idx: user_group_idx,
                breed_code: breed_code
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                const user_group_idx = sessionStorage.getItem("user_group_idx");
                webix.ajax().del(schedulerUrl + "sales/items/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_sale_item_grid();
                        webix.ajax().get(schedulerUrl + "sales/items/options?user_idx=" + user.id + "&farm_idx=" + user_group_idx, function(text, data){
                            var options = data.json();
                        
                            var list = $$("sales_item").getPopup().getList();
                            list.clearAll();
                            list.parse(options);
                        });
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "sales/items/select", {id: id.row}).then(function(result) {
                    const item = result.json();
                    $$("item_name").setValue(item.item_name);
                    $$("item_description").setValue(item.item_description);
                    $$("sale_item_id").setValue(item.id);
                    $$("register_sale_item_button").setValue("Update");
                })
            }
        }
    };
    const register_sale_item_page = {
        view: "form",
        id: "register-saleitem",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_sale_item_label,
                    register_sale_item_header,
                    register_sale_item_label_list,
                    register_sale_item_form,
                    register_sale_item_list_label,
                    register_sale_item_datatable,
                ]
            }
        ],
    };
    // ----------- Register sale page End ----------------
    // ----------- Manage sale page Start ----------------
    const manage_sale_label = {
        view: "label",
        template: "Input sales data",
        css: {
            "font-size": "24px"
        }
    }
    const manage_sale_header = {
        cols : [
            {
                view: "label",
                label: "Register sales data"
            },
            {}
        ]
        
    }
    const manage_sale_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "date", gravity: 0.1 },
            { view: "label", label: "sales items", gravity: 0.1 },
            { view: "label", label: "qnty", gravity: 0.1 },
            { view: "label", label: "unit price", gravity: 0.1 },
            { view: "label", label: "amount", gravity: 0.1 },
            { gravity: 0.1 },
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    }
    const manage_sale_form = {
        view: "form",
        id: "manage_sale_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "sale_id", name: "id" },
            { view: "datepicker", placeholder: "date", id: "date5", name: "date", gravity: 0.1 },
            {
                view: "richselect",
                name: "sales_item",
                id: "sales_item",
                placeholder: "sales item",
                required: true,
                gravity: 0.1,
                options: schedulerUrl + "sales/items/options?user_idx=" + user.id + "&farm_idx=" + sessionStorage.getItem("user_group_idx"),
            },
            { view: "text", placeholder: "qnty", id: "qnty", name: "qnty", gravity: 0.1, attributes:{type:"number"}, 
                on: {
                    onChange: function(nv, ov) {
                        const amount = parseInt(nv) * parseInt($$("unit_price2").getValue());
                        $$("amount").setValue(amount);
                    }
                }    
            },
            { view: "text", placeholder: "unit_price", id: "unit_price2", name: "unit_price", gravity: 0.1, attributes:{type:"number"} ,
                on: {
                    onChange: function(nv, ov) {
                        const amount = parseInt(nv) * parseInt($$("qnty").getValue());
                        $$("amount").setValue(amount);
                    }
                }  
            },
            { view: "text", placeholder: "amount", id: "amount", name: "amount", gravity: 0.1, attributes:{type:"number"}, readonly: true},
            { 
                rows: [
                    {
                        view: "button", value: "register", id: "register_sale_button",
                        click: function(){
                            if ($$("manage_sale_form").validate()) {
                                const val = $$("manage_sale_form").getValues();
                                const user_idx = user.id;
                                const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                                const breed_code = JSON.parse(sessionStorage.getItem("breed_code"));
                                
                                webix.ajax().post(schedulerUrl + "sales/register", {
                                    id: val.id,
                                    user_idx: user_idx,
                                    farm_idx: user_group_idx,
                                    breed_code: breed_code,
                                    date: val.date,
                                    item_idx: val.sales_item,
                                    unit_price: val.unit_price,
                                    qnty: val.qnty
                                }).then(function(data) {
                                    const response = data.text();
                                    if (response != "") {
                                        if (val.id == "" ) {
                                            webix.alert({ title: "Register sales", type: "alert-success", text: "Register a sales successfully!" }).then(function (result){
                                                refresh_sale_grid();
                                                $$("manage_sale_form").clear();
                                            })
                                        } else {
                                            webix.alert({ title: "Update sales", type: "alert-success", text: "Update a sales successfully!" })
                                            $$("manage_sale_form").clear();
                                            $$("register_sale_button").setValue("Register");

                                            refresh_sale_grid();
                                        }
                                    } else {
                                        webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                                    }
                                    
                                })
                            }
                        }
                    },
                    {}
                ],
                gravity: 0.1,
                css: {
                    "margin": "auto!important",
                    "padding": "20px"
                }
            },
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        },
        gravity: 0.2
    }
    const manage_sale_list_label = {
        view: "label",
        label: "List of sales item"
    }
    const manage_sale_datatable = {
        view:"datatable",
        id: "sale_grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"date",	header:"date", fillspace:true },
            { id:"item_idx",	header:"item", fillspace:true, template: function(obj) {
                var data = webix.ajax().sync().get(schedulerUrl + "sales/items/select", {
                    id: obj.item_idx
                }).responseText;
                return JSON.parse(data).item_name;
            }},
            { id:"qnty",	header:"qnty", fillspace:true  },
            { id:"unit_price",	header:"unit_price", fillspace:true  },
            { id:"amount",	header:"amount", fillspace:true, template: function(obj) {
                return parseInt(obj.qnty) * parseInt(obj.unit_price);
            }},
        ],
        url:function(params){
            const user_id = user.id;
            const user_group_idx = sessionStorage.getItem("user_group_idx");
            const breed_code = sessionStorage.getItem("breed_code");
            var data = webix.ajax().sync().get(schedulerUrl + "sales/all", {
                user_idx: user_id,
                farm_idx: user_group_idx,
                breed_code: breed_code
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "sales/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_sale_grid();
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "sales/select", {id: id.row}).then(function(result) {
                    const sale = result.json();
                    const sale_amount = parseInt(sale.qnty) * parseInt(sale.unit_price);
                    $$("sale_id").setValue(sale.id);
                    $$("date5").setValue(new Date(sale.date));
                    $$("sales_item").setValue(sale.item_idx);
                    $$("qnty").setValue(sale.qnty);
                    $$("unit_price2").setValue(sale.unit_price);
                    $$("amount").setValue(sale_amount);
                    $$("register_sale_button").setValue("Update");
                })
            }
        }
    };
    const manage_sale_page = {
        view: "form",
        id: "manage-sale",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    manage_sale_label,
                    manage_sale_header,
                    manage_sale_label_list,
                    manage_sale_form,
                    manage_sale_list_label,
                    manage_sale_datatable,
                ]
            }
        ],
    };
    // ----------- Manage sale page End ----------------
    // ----------- Register expense item modal Start ----------------
    const register_expense_item_label = {
        view: "label",
        template: "Register expense item code",
        css: {
            "font-size": "24px"
        }
    };
    const register_expense_item_header = {
        cols : [
            {
                view: "label",
                label: "Register expense_item code"
            },
            {},
        ]
    };
    const register_expense_item_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "name", gravity: 0.1 },
            { view: "label", label: "description", gravity: 0.1 },
            { gravity: 0.1}
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    };
    const register_expense_item_form = {
        view: "form",
        id: "register_expense_item_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "expense_item_id", name: "id" },
            { view: "text", id: "item_name1", placeholder: "item_name", name: "item_name" },
            { view: "text", id: "item_description1", placeholder: "item_description", name: "item_description" },
            {
                view: "button", value: "Register", id: "register_expense_item_button",
                click: function() {
                    if ($$("register_expense_item_form").validate()) {
                        const val = $$("register_expense_item_form").getValues();
                        const user_idx = user.id;
                        const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                        const breed_code = JSON.parse(sessionStorage.getItem("breed_code"));
                        
                        webix.ajax().post(schedulerUrl + "expenses/items/register", {
                            user_idx: user_idx,
                            farm_idx: user_group_idx,
                            breed_code: breed_code,
                            id: val.id,
                            date: new Date(),
                            item_name: val.item_name,
                            item_description: val.item_description,
                        }).then(function(data) {
                            const response = data.text();
                            if (response != "") {
                                if (val.id == "" ) {
                                    webix.alert({ title: "Register expenses item", type: "alert-success", text: "Register a expenses item successfully!" }).then(function (result){
                                        refresh_expense_item_grid();
                                        $$("register_expense_item_form").clear();
                                        webix.ajax().get(schedulerUrl + "expenses/items/options?user_idx=" + user.id +"&farm_idx=" + user_group_idx, function(text, data){
                                            var options = data.json();
                                        
                                            var list = $$("expenses_item").getPopup().getList();
                                            list.clearAll();
                                            list.parse(options);

                                        });
                                    })
                                } else {
                                    webix.alert({ title: "Update expenses item", type: "alert-success", text: "Update a expenses item successfully!" })
                                    $$("register_expense_item_form").clear();
                                    $$("register_expense_item_button").setValue("Register");

                                    refresh_expense_item_grid("");
                                    webix.ajax().get(schedulerUrl + "expenses/items/options?user_idx=" + user.id + "&farm_idx=" + user_group_idx, function(text, data){
                                        var options = data.json();
                                    
                                        var list = $$("expenses_item").getPopup().getList();
                                        list.clearAll();
                                        list.parse(options);

                                    });
                                }
                            } else {
                                webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                            }
                        })
                    }
                }
            }
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        }
    };
    const register_expense_item_list_label = {
        view: "label",
        label: "List of expense_item code"
    };
    const register_expense_item_datatable = {
        view:"datatable",
        id: "expense_item_grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"date",    header:"Date", fillspace:true },
            { id:"item_name",   header:"Item Name", fillspace:true },
            { id:"item_description",    header:"Item Description", fillspace:true  },
        ],
        url:function(params){
            const user_id = user.id;
            const user_group_idx = sessionStorage.getItem("user_group_idx");
            const breed_code = sessionStorage.getItem("breed_code");
            var data = webix.ajax().sync().get(schedulerUrl + "expenses/items/all", {
                user_idx: user_id,
                farm_idx: user_group_idx,
                breed_code: breed_code
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "expenses/items/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_expense_item_grid();
                        webix.ajax().get(schedulerUrl + "expenses/items/options?user_idx=" + user.id + "&farm_idx=" + user_group_idx, function(text, data){
                            var options = data.json();
                        
                            var list = $$("expenses_item").getPopup().getList();
                            list.clearAll();
                            list.parse(options);
                        });
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "expenses/items/select", {id: id.row}).then(function(result) {
                    webix.ajax().get(schedulerUrl + "expenses/items/select", {id: id.row}).then(function(result) {
                    const item = result.json();
                    $$("item_name1").setValue(item.item_name);
                    $$("item_description1").setValue(item.item_description);
                    $$("expense_item_id").setValue(item.id);
                    $$("register_expense_item_button").setValue("Update");
                })
                })
            }
        }
    };
    const register_expense_item_page = {
        view: "form",
        id: "register-expenseitem",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    register_expense_item_label,
                    register_expense_item_header,
                    register_expense_item_label_list,
                    register_expense_item_form,
                    register_expense_item_list_label,
                    register_expense_item_datatable,
                ]
            }
        ],
    };
    // ----------- Register expense page End ----------------
    // ----------- Manage expense page Start ----------------
    const manage_expense_label = {
        view: "label",
        template: "Input expenses data",
        css: {
            "font-size": "24px"
        }
    }
    const manage_expense_header = {
        cols : [
            {
                view: "label",
                label: "Register expenses data"
            },
            {}
        ]
        
    }
    const manage_expense_label_list = {
        type: "section",
        cols: [
            { view: "label", label: "date", gravity: 0.1 },
            { view: "label", label: "expenses items", gravity: 0.1 },
            { view: "label", label: "qnty", gravity: 0.1 },
            { view: "label", label: "unit price", gravity: 0.1 },
            { view: "label", label: "amount", gravity: 0.1 },
            { gravity: 0.1 },
        ],
        css: {
            "background": "lightgrey!important",
            "text-align": "center"
        }
    }
    const manage_expense_form = {
        view: "form",
        id: "manage_expense_form",
        margin: 10,
        borderless: true,
        cols: [
            { view: "text", hidden: true, id: "expense_id", name: "id" },
            { view: "datepicker", placeholder: "date", id: "date6", name: "date", gravity: 0.1 },
            {
                view: "richselect",
                name: "expenses_item",
                id: "expenses_item",
                placeholder: "expenses item",
                required: true,
                gravity: 0.1,
                options: schedulerUrl + "expenses/items/options?user_idx=" + user.id + "&farm_idx=" + sessionStorage.getItem("user_group_idx"),
            },
            { view: "text", placeholder: "qnty", id: "qnty2", name: "qnty", gravity: 0.1, attributes:{type:"number"} ,
                on: {
                    onChange: function(nv, ov) {
                        const amount = parseInt(nv) * parseInt($$("unit_price3").getValue());
                        $$("amount1").setValue(amount);
                    }
                } 
            },
            { view: "text", placeholder: "unit_price", id: "unit_price3", name: "unit_price", gravity: 0.1, attributes:{type:"number"},
                on: {
                    onChange: function(nv, ov) {
                        const amount = parseInt(nv) * parseInt($$("qnty2").getValue());
                        $$("amount1").setValue(amount);
                    }
                } 
            },
            { view: "text", placeholder: "amount", id: "amount1", name: "amount", gravity: 0.1, attributes:{type:"number"}, readonly: true },
            { 
                rows: [
                    {
                        view: "button", value: "register", id: "register_expense_button",
                        click: function(){
                            if ($$("manage_expense_form").validate()) {
                                const val = $$("manage_expense_form").getValues();
                                const user_idx = user.id;
                                const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                                const breed_code = JSON.parse(sessionStorage.getItem("breed_code"));
                                
                                webix.ajax().post(schedulerUrl + "expenses/register", {
                                    id: val.id,
                                    user_idx: user_idx,
                                    farm_idx: user_group_idx,
                                    breed_code: breed_code,
                                    date: val.date,
                                    item_idx: val.expenses_item,
                                    unit_price: val.unit_price,
                                    qnty: val.qnty
                                }).then(function(data) {
                                    const response = data.text();
                                    if (response != "") {
                                        if (val.id == "" ) {
                                            webix.alert({ title: "Register expenses", type: "alert-success", text: "Register a expenses successfully!" }).then(function (result){
                                                refresh_expense_grid();
                                                $$("manage_expense_form").clear();
                                            })
                                        } else {
                                            webix.alert({ title: "Update expenses", type: "alert-success", text: "Update a expenses successfully!" })
                                            $$("manage_expense_form").clear();
                                            $$("register_expense_button").setValue("Register");

                                            refresh_expense_grid();
                                        }
                                    } else {
                                        webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                                    }
                                })
                            }
                        }
                    },
                    {}
                ],
                gravity: 0.1,
                css: {
                    "margin": "auto!important",
                    "padding": "20px"
                }
            },
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        },
        gravity: 0.2
    }
    const manage_expense_list_label = {
        view: "label",
        label: "List of expenses item"
    }
    const manage_expense_datatable = {
        view:"datatable",
        id: "expense_grid",
        autoConfig:true,
        columns:[
            { id:"id", header:"#", width: 50 },
            { id:"date",	header:"date", fillspace:true },
            { id:"item_idx",	header:"item", fillspace:true, template: function(obj) {
                var data = webix.ajax().sync().get(schedulerUrl + "expenses/items/select", {
                    id: obj.item_idx
                }).responseText;
                return JSON.parse(data).item_name; 
            }},
            { id:"qnty",	header:"qnty", fillspace:true  },
            { id:"unit_price",	header:"unit_price", fillspace:true  },
            { id:"amount",	header:"amount", fillspace:true, template: function(obj) {
                return parseInt(obj.qnty) * parseInt(obj.unit_price);
            }},
        ],
        url:function(params){
            const user_id = user.id;
            const user_group_idx = sessionStorage.getItem("user_group_idx");
            const breed_code = sessionStorage.getItem("breed_code");
            var data = webix.ajax().sync().get(schedulerUrl + "expenses/all", {
                user_idx: user_id,
                farm_idx: user_group_idx,
                breed_code: breed_code
            }).responseText;
            if (data != "") {
                this.parse(data);
            }
        },
        scroll:"y",
        onClick:{
            "wxi-trash":function(event, id, node){
                webix.ajax().del(schedulerUrl + "expenses/remove?id=" + id.row).then(function(result) {
                    if (result.text() != "") {
                        refresh_expense_grid();
                    }
                })
            },
            "wxi-pencil":function(event, id, node){
                webix.ajax().get(schedulerUrl + "expenses/select", {id: id.row}).then(function(result) {
                    const expense = result.json();
                    const expense_amount = parseInt(expense.qnty) * parseInt(expense.unit_price);
                    $$("expense_id").setValue(expense.id);
                    $$("date6").setValue(new Date(expense.date));
                    $$("expenses_item").setValue(expense.item_idx);
                    $$("qnty2").setValue(expense.qnty);
                    $$("unit_price3").setValue(expense.unit_price);
                    $$("amount1").setValue(expense_amount);
                    $$("register_expense_button").setValue("Update");
                })
            }
        }
    };
    const manage_expense_page = {
        view: "form",
        id: "manage-expense",
        elements: [
            {
                type: "section",
                borderless: false,
                rows: [
                    manage_expense_label,
                    manage_expense_header,
                    manage_expense_label_list,
                    manage_expense_form,
                    manage_expense_list_label,
                    manage_expense_datatable,
                ]
            }
        ],
    };
    // ----------- Manage expense page End ----------------
    // ----------- Manage feed first page Start ----------------
    const feed_label = {
        view: "label",
        label: "Feeding each building",
        css: {
            "font-size": "20px",
            "font-weight": "bold"
        }
    }
    const datepicker = {
        view: "datepicker",
		id: "date",
        name: "date",
        value: new Date(2012, 6, 8),
        format: "%Y, %m-%d %l",
        timepicker: true,
        width: 300,
        on:{
            onChange:function(nv, ov){
                webix.message("Value was "+ov+" <br>Value now "+nv);
            },
        }
    };
    const save_button = {
        view: "button",
        label: "Save",
        id: "save_button",
        click: function(){
            if ($$("manage_feed_form").validate()) {
                const val = $$("$panel1");

                const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));
                const breed_code = JSON.parse(sessionStorage.getItem("breed_code"));
              
                console.log(val.getValues());

                // webix.ajax().post(schedulerUrl + "foods/register", {
                //     user_idx: user.id,
                //     farm_idx: user_group_idx,
                //     breed_code: breed_code,
                //     date: val.date,
                //     code: val.code,
                //     in_kg: val.in_kg,
                //     unit_price: val.unit_price,
                //     sex: val.sex,
                //     tank_max: val.tank_max,
                //     nutrition_name: val.nutrition_name,
                //     nutrition_in_kg: val.nutrition_in_kg
                // }).then(function(data) {
                //     const response = data.text();
                //     if (response == "success") {
                //         webix.alert({ title: "Register Food", type: "alert-success", text: "Register a food successfully!" }).then(function (result){
                //             $$("register_food_form").clear();
                //         })
                //     } else {
                //         webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                //     }
                // })
            }
        }
    }
    const panel = {
        view: "panel",
        type: "form",
        body: {
            rows: [
                {
                    cols: [
                        {
                            view: "template",
                            name: "$value",
                            template: "<span style='border-radius: 50%; padding: 5px; background: lightgrey; width: 20px; height: 20px;'>#building_no#</span>",
                            css: {
                                "border": "none!important;"
                            }
                        },
                        {
                            view: "switch", value: 1,
                            gravity: 0.25,
                            on: {
                                onChange: function (newValue, oldValue, config) {
									const male_feed = this.getParentView().getParentView().getChildViews()[7];
									const female_feed = this.getParentView().getParentView().getChildViews()[5];
									if (newValue == 0) {
										male_feed.disable();
										female_feed.disable();
									} else {
										male_feed.enable();
										female_feed.enable();
									}	
								}
                            }
                        }
                    ]
                },
                // {
                //     cols: [
                //         {
                //             view: "text",
                //             value: "100",
                //             label: "male_feed",
                //             labelPosition: "top",
                //             css: "borderR",
                //             gravity: 0.3,
                //             on: {
                //                 onChange: function (nv, ov) {
                //                     var user_id = user.id;
                //                     var farm_id = JSON.parse(sessionStorage.getItem("user_group_idx"));
                //                     var breed_code = JSON.parse(sessionStorage.getItem("breed_code"));
                //                     var panel_id = parseInt(panelID.slice(6));
                //                     var male_feed = parseInt(nv);
                //                     var female_feed = parseInt(this.getParentView().getChildViews()[1].getValue());
                //                     var total = male_feed + female_feed;
                //                     this.getParentView().getChildViews()[2].setValue(total);

                //                     webix.ajax().post(schedulerUrl + "feeds/update", {
                //                         user_idx: user_id,
                //                         farm_idx: farm_id,
                //                         breed_code: breed_code,
                //                         building_id: panel_id,
                //                         female_feed: female_feed,
                //                         male_feed: male_feed,
                //                         date: $$("date").getValue()
                //                     });
                //                 }
                //             }
                //         },
                //         {
                //             view: "text",
                //             bottomLabel: "female_feed",
                //             value: "100",
                //             align: "center",
                //             css: "borderR",
                //             gravity: 0.3,
                //             on: {
                //                 onChange: function (nv, ov) {
                //                     var user_id = user.id;
                //                     var farm_id = JSON.parse(sessionStorage.getItem("user_group_idx"));
                //                     var breed_code = JSON.parse(sessionStorage.getItem("breed_code"));
                //                     var panel_id = parseInt(panelID.slice(6));
                //                     var male_feed = parseInt(this.getParentView().getChildViews()[0].getValue());
                //                     var female_feed = parseInt(nv);
                //                     var total = male_feed + female_feed;
                //                     this.getParentView().getChildViews()[2].setValue(total);

                //                     webix.ajax().post(schedulerUrl + "feeds/update", {
                //                         building_id: panel_id,
                //                         female_feed: female_feed,
                //                         male_feed: male_feed,
                //                         date: $$("date").getValue()
                //                     });
                //                 }
                //             }
                //         },
                //         {
                //             view: "text",
                //             value: "100",
                //             readonly: true,
                //             bottomLabel: "total_feed",
                //             align: "center",
                //             css: "borderR",
                //             gravity: 0.3
                //         },
                //     ],
                //     css: {
                //         "background": "lightgrey",
                //         "color": "blue",
                //         "text-align": "center"
                //     }
                // },
                {
                    rows: [
                        {
                            view: "label",
                            label: "female",
                            align: "center"
                        },
                        {
                            cols: [
                                {
                                    rows: [
                                        {
                                            view: "label",
                                            label: "each",
                                            align: "center"
                                        },
                                        {
                                            cols: [
                                                {
                                                    view: "text",
                                                },
                                                {
                                                    view: "label",
                                                    label: "g",
                                                    autowidth: true
                                                }
                                            ],
                                        }
                                    ]
                                },
                                { width: 50 },
                                {
                                    rows: [
                                        {
                                            view: "label",
                                            label: "total",
                                            align: "center"
                                        },
                                        {
                                            cols: [
                                                {
                                                    view: "text",

                                                },
                                                {
                                                    view: "label",
                                                    label: "kg",
                                                    autowidth: true
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ],
                    padding: 10,
                    css: {
                        "background": "lightgrey",
                        "margin-bottom": "10px!important",
                    }
                },
                {
                    rows: [
                        {
                            view: "label",
                            label: "male",
                            align: "center"
                        },
                        {
                            cols: [
                                {
                                    rows: [
                                        {
                                            view: "label",
                                            label: "each",
                                            align: "center"
                                        },
                                        {
                                            cols: [
                                                {
                                                    view: "text",

                                                },
                                                {
                                                    view: "label",
                                                    label: "g",
                                                    autowidth: true
                                                }
                                            ]
                                        }
                                    ]
                                },
                                { width: 50 },
                                {
                                    rows: [
                                        {
                                            view: "label",
                                            label: "total",
                                            align: "center"
                                        },
                                        {
                                            cols: [
                                                {
                                                    view: "text",

                                                },
                                                {
                                                    view: "label",
                                                    label: "kg",
                                                    autowidth: true
                                                }
                                            ]
                                        }
                                    ],
                                }
                            ]
                        }
                    ],
                    padding: 10,
                    css: {
                        "background": "lightgrey",
                        "margin-bottom": "10px!important",
                    }
                },
                {
                    cols: [
                        { view: "richselect", placeholder: "select femalefood", name: "female_food", options: [{id: 1, value: "20215326"}, {id: 2, value: "20216532"}]},
                        { view: "richselect", placeholder: "select malefood", name: "male_food", options: [{id: 1, value: "20215326"}, {id: 2, value: "20216532"}]},
                    ]
                },
                {
                    view: "label",
                    label: "female-feed-graph",
                },
                { view: "slider", value: "50", min: 0, max: 100, title: "#value#", css: "female-feed" },
                {
                    view: "label",
                    label: "male-feed-graph",
                },
                { view: "slider", value: "50", min: 0, max: 100, title: "#value#", css: "male-feed" }
            ],
            minHeight: 550
        },
        minWidth: 330,
        minHeight: 550,
    }
    const panels = {
        margin: 10, padding: 0,
        view: "flexdatalayout",
        cols: [panel],
        url: function(params) {
            const farm_idx = sessionStorage.getItem("user_group_idx");

            var data = webix.ajax().sync().get(schedulerUrl + "feeds/all", {
                farm_idx: farm_idx
            }).responseText;

            if (JSON.parse(data) == 0) {
                building_num = JSON.parse(data).length;
            }

            return data;
        }
    }
	const manage_feed_form = {
        view: "form",
        id: "manage_feed_form",
        rows: [
            {
                cols: [
                    feed_label,
                    {},
                    { view:"icon", icon:"wxi-angle-left", id:"prev", click: function(){ 
                        changeRange(-1);
                    }},
                    datepicker,
                    { view:"icon", icon:"wxi-angle-right", id:"next", click: function(){
                        changeRange(1);
                    }},
                    {},
                    save_button
                ]
            },
            {
                view: "label",
                label: "Info feeding"
            },
            {
                view: "scrollview",
                body: webix.copy(panels)
            }
        ],
        rules: {
            $all:webix.rules.isNotEmpty,
        }
    }
    const manage_feed = {
			view: "form",
			id: "manage-feed",
			elements: [
                manage_feed_form
			]
		};
	// ----------- Manage feed first page End ----------------
    // ----------- Supply water page Start ----------------
    const water_label = {
        view: "label",
        label: "Supply water each building",
        css: {
            "font-size": "20px",
            "font-weight": "bold"
        }
    }
    const datepicker1 = {
        view: "datepicker",
		id: "date1",
        value: new Date(2012, 6, 8),
        format: "%Y, %m-%d %l",
        timepicker: true,
        width: 300
    };
    const save_button1 = {
        view: "button",
        label: "Save",
        id: "save_button1"
    }
    const water_panel = {
        view: "panel",
        body: {
            padding: 20,
            rows: [
                {
                    cols: [
                        {
                            view: "template",
                            name: "$value",
                            template: "<span style='border-radius: 50%; padding: 5px; background: lightgrey;'>#building_no#</span>",
                            css: {
                                "border": "none!important;"
                            }
                        },
                        {
                            view: "switch", value: 1,
                            gravity: 0.25,
                            on: {
                                onChange: function (newValue, oldValue, config) {
									const male_feed = this.getParentView().getParentView().getChildViews()[7];
									const female_feed = this.getParentView().getParentView().getChildViews()[5];
									if (newValue == 0) {
										male_feed.disable();
										female_feed.disable();
									} else {
										male_feed.enable();
										female_feed.enable();
									}	
								}
                            }
                        }
                    ]
                },
                { height: 20 },
                {
                    view: "label",
                    padding: 10,
                    template: "<div style='color: blue'>200</div><div>total water</div>",
                    align: "center",
                    css: {
                        "background": "lightgrey",
                    }
                },
                { height: 20 },
                {
                    cols: [
                        {
                            view: "label",
                            label: "water supply time"
                        },
                        {
                            fillspace: true,
                        },
                        {
                            view: "button",
                            label: "add",
                            type:"icon", icon:"wxi-plus",
                            autowidth: true,
                            click: function() {
                                const list = this.getParentView().getParentView().getChildViews()[6];
                                list.add({title:"The Shawshank Redemption", year:1994, votes:678790, rating:9.2, rank:1})
                            }
                        },
                        {
                            view: "button",
                            label: "del",
                            type:"icon", icon:"wxi-minus",
                            autowidth: true,
                            click: function() {
                                const list = this.getParentView().getParentView().getChildViews()[6];
                                if (list.getSelectedId())
                                    list.remove(list.getSelectedId());
                            }
                        }
                    ]
                },
                { height: 10 },
                {
                    view: "list",
                    template: 
                        "<div style='display: flex; justify-content: space-around; align-items: center'>" + 
                            "<input type='number' style='width: 30px;'/>HH " + 
                            "<input type='number' style='width: 30px;'/>MM - " + 
                            "<input type='number' style='width: 30px;'/>HH "+
                            "<input type='number' style='width: 30px;'/>MM" +
                        "</div>",
                    select: true,
                    height: 100
                },
                { height: 20 },
                {
                    cols: [
                        { view: "richselect", placeholder: "med_type", options: ["medi", "non-medi"] },
                        { view: "richselect", placeholder: "measure", options: ["medi1", "medi2", "medi3", "medi4", "medi5"] },
                        { view: "text", placeholder: "in_qnty", attributes: {type: "number"} }
                    ]
                },
                { height: 20 },
                {  
                    view:"list", 
                    select: false,
                    type: {
                        height: 'auto',
                    },
                    layout: "x",
                    template: (row) => 
                    /* click on the button should invoke createMenu(<id>) where <id> is property of list item */
                        `<div class="tag_list ` + row.type + `"><span class="hoverButton">
                            <button type="button" class="webix_icon_button">
                                <span class="webix_icon wxi-close close-icon"></span>
                            </button>
                        </span>`+ row.value + `</div>`,
                    data:[
                        {id: 1, value: 'medi1', type: "medi"},
                        {id: 2, value: 'medi2', type: "medi"},
                        {id: 3, value: 'no-medi1', type: "non-medi"},
                        {id: 4, value: 'no-medi2', type: "non-medi"},
                        {id: 5, value: 'medi3', type: "medi"},
                    ], 
                },
                {
                    view: "label",
                    label: "medi",
                },
                { view: "slider", value: "50", min: 0, max: 100, title: "#value#", css: "female-feed" },
                {
                    view: "label",
                    label: "non-medi",
                },
                { view: "slider", value: "50", min: 0, max: 100, title: "#value#", css: "male-feed" }
            ],
        },
        minWidth: 330,
        minHeight: 600
    }
    const water_panels = {
        margin: 10, padding: 0,
        view: "flexdatalayout",
        cols: [water_panel],
        url: function(params) {
            const farm_idx = sessionStorage.getItem("user_group_idx");

            var data = webix.ajax().sync().get(schedulerUrl + "feeds/all", {
                farm_idx: farm_idx
            }).responseText;
            return data;
        }
    }
	const supply_water = {
        view: "form",
        id: "supply-water",
        elements: [
            {
                cols: [
                    water_label,
                    {},
                    { view:"icon", icon:"wxi-angle-left", id:"prev1", click: function(){ 
                        changeRange1(-1);
                    }},
                    datepicker1,
                    { view:"icon", icon:"wxi-angle-right", id:"next1", click: function(){
                        changeRange1(1);
                    }},
                    {},
                    save_button1
                ]
            },
            {
                view: "label",
                label: "Info water"
            },
            {
                view: "scrollview",
                body: webix.copy(water_panels)
            }
        ]
    };
	// ----------- Supply water page End ----------------
    // ----------- Send Breed page Start ----------------
    const send_breed_label = {
        view: "label",
        label: "Send Breed",
        css: {
            "font-size": "20px",
            "font-weight": "bold"
        }
    }
    const send_breed_list = { 
        view:"dbllist",
        list:{ 
            select: true,
            autoHeight: true,
            scroll: true,
            template:function(obj, common){
                var dir = (common.id  === "left" ? "right" : "left");
                return "<div style='display: flex; justify-content: space-between;'>BD_No <span style='border-right: 2px solid; margin-right: 2px;'></span> " + obj.bd_no + "<span style='border-right: 2px solid; margin: 2px;'></span>" + 
                        "Female <span style='border-right: 2px solid; margin-right: 2px;'></span> " + obj.female + "<span style='border-right: 2px solid; margin: 2px;'></span>" +
                        "Male <span style='border-right: 2px solid; margin-right: 2px;'></span> " + obj.male + "<span style='border-right: 2px solid; margin: 2px;'></span>" + 
                        "Weekage <span style='border-right: 2px solid; margin-right: 2px;'></span> " + obj.weekage + "<span style='border-right: 2px solid; margin: 2px;'></span></div>";
            },
        },
        labelBottomLeft:"Object for send",
        labelBottomRight:"Object selected",
        data:[
            {id:"1", bd_no:"1", female: "5000", male: "0", weekage: "32"},
            {id:"2", bd_no:"2", female: "5000", male: "0", weekage: "32"},
            {id:"3", bd_no:"3", female: "3000", male: "0", weekage: "32"},
            {id:"4", bd_no:"4", female: "4000", male: "0", weekage: "32"},
            {id:"5", bd_no:"5", female: "5000", male: "0", weekage: "32"},
            {id:"6", bd_no:"6", female: "6000", male: "0", weekage: "32"},
            {id:"7", bd_no:"7", female: "3000", male: "0", weekage: "32"},
            {id:"8", bd_no:"8", female: "5000", male: "0", weekage: "32"},
        ]
    };
    const send_breed_form = {
        view: "form",
        id: "send_breed_form",
        margin: 10,
        borderless: true,
        rows: [
            {
                cols: [
                    { view: "richselect", placeholder: "Breed_code", id: "breed_code", name: "breed_code", label: "Breed_code", labelWidth: 130, gravity: 0.1, options: [{id: 1, value: "20215326"}, {id: 2, value: "20216532"}]},
                    { view: "datepicker", placeholder: "Date_send", id: "date4", name: "date" , label: "Date_send", labelWidth: 130, gravity: 0.1 },
                    { view: "richselect", placeholder: "To_farm_idx", id: "to_farm_idx", name: "to_farm_idx", label: "To_farm_idx", labelWidth: 130, gravity: 0.1, options: [{id: 1, value: "farm1"}, {id: 2, value: "farm2"}]},
                    { view: "multiselect", placeholder: "Vehicle_no", id: "vehicle_no", name: "vehicle_no", label: "Vehicle_no", labelWidth: 130, gravity: 0.1, options: ["AC123A12", "SD232S54"]},
                ],
            },
            { 
                align:"right",
                body:{ 
                    view: "button",
                    value: "SEND",
                    width: 100,
                    click: function() {
                        if ($$("send_breed_form").validate()) {
                            const val = $$("send_breed_form").getValues();
                            const user_group_idx = JSON.parse(sessionStorage.getItem("user_group_idx"));

                            webix.ajax().post(schedulerUrl + "breeds/transfer", {
                                user_idx: user.id,
                                farm_idx: user_group_idx,
                                breed_code: val.breed_code,
                                date: val.date,
                                to_farm_idx: val.to_farm_idx,
                                vehicle_no: val.vehicle_no
                            }).then(function(data) {
                                const response = data.text();
                                if (response == "success") {
                                    webix.alert({ title: "Send Breed", type: "alert-success", text: "Send Breed successfully!" }).then(function (result){
                                        $$("send_breed_form").clear();
                                    })
                                } else {
                                    webix.alert({ title: "Some input values are not Correct \n Please try again", type: "alert-warning"})
                                }
                            })
                        }
                    }
                }
            }
        ],
        
        rules: {
            $all:webix.rules.isNotEmpty,
        },
        gravity: 0.2
    }
    const send_breed_page = {
        view: "form",
        id: "send-breed",
        elements: [
            send_breed_label,
            send_breed_form,
            {
                view:"forminput", name:"screens", body:send_breed_list, labelWidth:0 
            },
        ]
    };
    // ----------- Send Breed page End ----------------
    webix.ready(function () {
		if (!user) {
			window.location.href = "login";
		} else {
            sessionStorage.setItem("user_id", user.id);
        }

        webix.ui({
			rows: [
				{
					view: "toolbar", padding: 3, elements: [
						{
							view: "icon", icon: "mdi mdi-menu", click: function () {
								$$("menu_list").toggle();
							}
						},
						{ view: "label", label: "DonilFarm" },
						{},
						{ view: "button", label: "CCTV", gravity: 0.3 },
						{ view: "button", label: "scheduler", gravity: 0.3 },
						{
							view: "icon",
							icon: "mdi mdi-calendar-clock",
							tooltip: "스케줄보기",
							click: function () {
								location.href = "/scheduler";
							}
						},
						{ view: "button", label: "myInfo", gravity: 0.3 },
						{ view: "icon", icon: "mdi mdi-comment", badge: 4 },
						{ view: "icon", id: "bell_icon", icon: "mdi mdi-bell"}
					]
				},
				{
					cols: [
						sidebar,
						{
							id: "multi",
							animate: false,
							cells: [
								{
									id: "dashboard1",
									template: "dashboard"
								},
								manage_feed,
                                register_partner_page,
                                register_farm_page,
                                register_biotype_page,
                                register_breed_page,
                                register_authority_page,
                                register_worker_page,
                                register_fmn_page,
                                register_nutri_page,
                                register_food_page,
                                register_sale_item_page,
                                manage_sale_page,
                                register_expense_item_page,
                                manage_expense_page,
                                supply_water,
                                send_breed_page
							]
						}

					]
				},

			]
		});

        add_controls($$("grid"));
        add_controls($$("worker_grid"));
        add_controls($$("sale_grid"));
        add_controls($$("sale_item_grid"));
        add_controls($$("expense_grid"));
        add_controls($$("expense_item_grid"));
        add_controls($$("fmn_code_grid"));
        add_controls($$("partner_grid"));
        add_controls($$("biotype_grid"));
        add_controls($$("auth_rule_grid"));
        add_controls($$("food_grid"));
        add_controls($$("medi_grid"));
        add_controls($$("non_medi_grid"));
        add_controls($$("food_nutri_grid"));
        //--
        webix.attachEvent("onClick", function(e) {
            if (e) {
                //check if the clicked element is a view
                if ($$(e.target)) {
                    if ($$(e.target).getParentView()) {
                        var layout = $$(e.target).getParentView();
                        while(layout.config.view !== "panel") {
                            layout = layout.getParentView();
                            if (!layout) {
                                return false;
                            }
                        }
                        if (layout.config.view == "panel") {
                                webix.message(layout.config.id);
                                panelID= layout.config.id;
                                
                        }
                    }
                }
            }
        })
    });

    function select_breed() {
        const farm_idx = sessionStorage.getItem("user_group_idx");
        webix.ajax().get(schedulerUrl + "farms/breeds", {
            user_idx: user.id,
            farm_idx: farm_idx
        }).then(function(data) {
            const breeds = data.json();
            
            if (breeds && breeds.length > 0) {
                const breed_code = sessionStorage.getItem("breed_code");
                if (breeds.length > 1) {
                    var breeds_value = [];
                    breeds.forEach(breed => {
                        breeds_value.push({
                            id: breed.uuid,
                            title: breed.uuid
                        })
                    });
                    $$("breeds").define("data", breeds_value);
                    if (!breed_code) {
                        breed_select_win.show();
                    }
                } else {
                    sessionStorage.setItem("breed_code", breeds[0].uuid);
                }
            } else {
                webix.alert({
                    title:"Warning!",
                    text:"You don't have any breeds. please register breed first!",
                    type:"alert-warning"
                })
                .then(function(result){
                    $$("menu_list").select("register-breed");
                    $$("menu_list").open($$("menu_list").getParentId("register-breed"));
                })
            }
        })
    }

	function changeRange(sign){
		const oldValue = $$("date").getValue();

		let newValue = webix.Date.add(oldValue, sign, "day");
		$$("date").setValue(newValue);

        webix.message("Value was "+oldValue+" <br>Value now "+newValue);
	}

    function changeRange1(sign){
		const date = $$("date1").getValue();

		let new_date = webix.Date.add(date, sign, "day");
		$$("date1").setValue(new_date);
	}

    function refresh_breed_grid() {
        var user_id = user.id;
        var user_group_idx = sessionStorage.getItem("user_group_idx");
        var data = webix.ajax().sync().get(schedulerUrl + "breeds/all", {
            uID: user_id,
            fID: user_group_idx
        }).responseText;
        
        $$("grid").clearAll();
        if (data != "") {
            $$("grid").parse(JSON.parse(data));
            $$("grid").refresh();
        }
    }

    function refresh_worker_grid() {
        var user_id = user.id;
        var user_group_idx = sessionStorage.getItem("user_group_idx");
        var data = webix.ajax().sync().get(schedulerUrl + "workers/all", {
            uID: user_id,
            fID: user_group_idx
        }).responseText;
        
        $$("worker_grid").clearAll();
        if (data != "") {
            $$("worker_grid").parse(JSON.parse(data));
            $$("worker_grid").refresh();
        }
    }
    
    function refresh_food_grid() {
        var user_id = user.id;
        var user_group_idx = sessionStorage.getItem("user_group_idx");
        var breed_code = sessionStorage.getItem("breed_code");
        var data = webix.ajax().sync().get(schedulerUrl + "foods/all", {
            uID: user_id,
            fID: user_group_idx,
            breed_code: breed_code
        }).responseText;
        
        $$("food_grid").clearAll();
        if (data != "") {
            $$("food_grid").parse(JSON.parse(data));
            $$("food_grid").refresh();
        }
    }
    
    function refresh_sale_grid() {
        const user_idx = user.id
        const user_group_idx = sessionStorage.getItem("user_group_idx");
        const breed_code = sessionStorage.getItem("breed_code");
        var data = webix.ajax().sync().get(schedulerUrl + "sales/all", {
            user_idx: user_idx,
            farm_idx: user_group_idx,
            breed_code: breed_code
        }).responseText;
        
        $$("sale_grid").clearAll();
        if (data != "") {
            $$("sale_grid").parse(JSON.parse(data));
            $$("sale_grid").refresh();
        }
    }

    function refresh_sale_item_grid() {
        const user_idx = user.id
        const user_group_idx = sessionStorage.getItem("user_group_idx");
        const breed_code = sessionStorage.getItem("breed_code");
        var data = webix.ajax().sync().get(schedulerUrl + "sales/items/all", {
            user_idx: user_idx,
            farm_idx: user_group_idx,
            breed_code: breed_code
        }).responseText;
        
        $$("sale_item_grid").clearAll();
        if (data != "") {
            $$("sale_item_grid").parse(JSON.parse(data));
            $$("sale_item_grid").refresh();
        }
    }

    function refresh_expense_grid() {
        const user_idx = user.id
        const user_group_idx = sessionStorage.getItem("user_group_idx");
        const breed_code = sessionStorage.getItem("breed_code");
        var data = webix.ajax().sync().get(schedulerUrl + "expenses/all", {
            user_idx: user_idx,
            farm_idx: user_group_idx,
            breed_code: breed_code
        }).responseText;
        
        $$("expense_grid").clearAll();
        if (data != "") {
            $$("expense_grid").parse(JSON.parse(data));
            $$("expense_grid").refresh();
        }
    }

    function refresh_expense_item_grid() {
        const user_idx = user.id
        const user_group_idx = sessionStorage.getItem("user_group_idx");
        const breed_code = sessionStorage.getItem("breed_code");
        var data = webix.ajax().sync().get(schedulerUrl + "expenses/items/all", {
            user_idx: user_idx,
            farm_idx: user_group_idx,
            breed_code: breed_code
        }).responseText;
        
        $$("expense_item_grid").clearAll();
        if (data != "") {
            $$("expense_item_grid").parse(JSON.parse(data));
            $$("expense_item_grid").refresh();
        }
    }
    
    function refresh_fmn_code_grid(search) {
        const user_idx = user.id
        const user_group_idx = sessionStorage.getItem("user_group_idx");
        var data = webix.ajax().sync().get(schedulerUrl + "fmn_codes/all", {
            user_idx: user_idx,
            farm_idx: user_group_idx,
            search: search
        }).responseText;
        
        $$("fmn_code_grid").clearAll();
        if (data != "") {
            $$("fmn_code_grid").parse(JSON.parse(data));
            $$("fmn_code_grid").refresh();
        }
    }

    function refresh_partner_grid(search) {
        const user_idx = user.id
        const user_group_idx = sessionStorage.getItem("user_group_idx");
        var data = webix.ajax().sync().get(schedulerUrl + "partners/all", {
            user_idx: user_idx,
            search: search
        }).responseText;
        
        $$("partner_grid").clearAll();
        $$("partner_grid").parse(JSON.parse(data));
        $$("partner_grid").refresh();
    }

    function refresh_biotype_grid(search) {
        const user_idx = user.id
        const user_group_idx = sessionStorage.getItem("user_group_idx");
        var data = webix.ajax().sync().get(schedulerUrl + "biotypes/all", {
            user_idx: user_idx,
            farm_idx: user_group_idx,
            search: search
        }).responseText;
        
        $$("biotype_grid").clearAll();
        if (data != "") {
            $$("biotype_grid").parse(JSON.parse(data));
            $$("biotype_grid").refresh();
        }
    }
    
    function refresh_auth_rule_grid(search) {
        const user_idx = user.id
        const user_group_idx = sessionStorage.getItem("user_group_idx");
        var data = webix.ajax().sync().get(schedulerUrl + "auth_rules/all", {
            search: search
        }).responseText;
        
        $$("auth_rule_grid").clearAll();
        if (data != "") {
            $$("auth_rule_grid").parse(JSON.parse(data));
            $$("auth_rule_grid").refresh();
        }
    }
    
    function refresh_medi_grid() {
        var user_id = user.id;
        var user_group_idx = sessionStorage.getItem("user_group_idx");
        var breed_code = sessionStorage.getItem("breed_code");
        var data = webix.ajax().sync().get(schedulerUrl + "mednutri/all", {
            uID: user_id,
            fID: user_group_idx,
            breed_code: breed_code,
            med_type: "medi"
        }).responseText;
        
        $$("medi_grid").clearAll();
        if (data != "") {
            $$("medi_grid").parse(JSON.parse(data));
            $$("medi_grid").refresh();
        }
    }

    function refresh_non_medi_grid() {
        var user_id = user.id;
        var user_group_idx = sessionStorage.getItem("user_group_idx");
        var breed_code = sessionStorage.getItem("breed_code");
        var data = webix.ajax().sync().get(schedulerUrl + "mednutri/all", {
            uID: user_id,
            fID: user_group_idx,
            breed_code: breed_code,
            med_type: "non-medi"
        }).responseText;
        
        $$("non_medi_grid").clearAll();
        if (data != "") {
            $$("non_medi_grid").parse(JSON.parse(data));
            $$("non_medi_grid").refresh();
        }
    }

    function refresh_food_nutri_grid() {
        var user_id = user.id;
        var user_group_idx = sessionStorage.getItem("user_group_idx");
        var breed_code = sessionStorage.getItem("breed_code");
        var data = webix.ajax().sync().get(schedulerUrl + "mednutri/all", {
            uID: user_id,
            fID: user_group_idx,
            breed_code: breed_code,
            med_type: "food-nutri"
        }).responseText;
        
        $$("food_nutri_grid").clearAll();
        if (data != "") {
            $$("food_nutri_grid").parse(JSON.parse(data));
            $$("food_nutri_grid").refresh();
        }
    }
 
    function add_controls(value) {
        var columns = value.config.columns;
        if (columns.length > 3) {
            columns.splice(columns.length, 0,{
                id:"trash",
                header:"Delete",
                template: "{common.trashIcon()}"
            });
            value.refreshColumns();

            columns.splice(columns.length-1, 0,{
                id:"edit",
                header:"Edit",
                template: "{common.editIcon()}"
            });
            value.refreshColumns();
        }
    }
</script>
</body>

</html>